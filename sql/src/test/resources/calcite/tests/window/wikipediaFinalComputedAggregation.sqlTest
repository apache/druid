type: "operatorValidation"

sql: |
    SELECT
      countryName,
      cityName,
      channel,
      string_agg(channel, '|') over (partition by cityName order by countryName) s
    FROM wikipedia
    WHERE countryName='Austria'
    GROUP BY 1, 2, 3

expectedOperators:
  - type: "naiveSort"
    columns:
      - column: "d1"
        direction: "ASC"
      - column: "p0"
        direction: "ASC"
  - type: "naivePartition"
    partitionColumns: [ "d1" ]
  - type: "window"
    processor:
      type: "framedAgg"
      frame:
          peerType: "RANGE"
          lowUnbounded: true
          lowOffset: 0
          uppUnbounded: false
          uppOffset: 0
          orderBy: [ {column: "p0", direction: ASC} ]
      aggregations:
        - {
            type: "filtered",
            "aggregator":
               {
                 "type": "expression",
                 "name": "w0",
                  "fields": [
                    "d2"
                  ],
                  "accumulatorIdentifier": "__acc",
                  "initialValue": "[]",
                  "initialCombineValue": "[]",
                  "isNullUnlessAggregated": true,
                  "shouldAggregateNullInputs": false,
                  "shouldCombineAggregateNullInputs": false,
                  "fold": "array_append(\"__acc\", \"d2\")",
                  "combine": "array_concat(\"__acc\", \"w0\")",
                  "finalize": "if(array_length(o) == 0, null, array_to_string(o, '|'))",
                  "maxSizeBytes": 1024
               },
            "filter": {
              "type": "not",
              "field": {
                "type": "null",
                "column": "d2"
              }
            },
            "name": null
           }

expectedResults:
  - ["Austria",null,"#de.wikipedia","#de.wikipedia"]
  - ["Austria","Horsching","#de.wikipedia","#de.wikipedia"]
  - ["Austria","Vienna","#de.wikipedia","#de.wikipedia|#es.wikipedia|#tr.wikipedia"]
  - ["Austria","Vienna","#es.wikipedia","#de.wikipedia|#es.wikipedia|#tr.wikipedia"]
  - ["Austria","Vienna","#tr.wikipedia","#de.wikipedia|#es.wikipedia|#tr.wikipedia"]