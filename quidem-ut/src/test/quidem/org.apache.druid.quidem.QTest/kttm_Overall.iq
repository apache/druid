#started Wed Jul 10 19:08:31 IST 2024
!use druidtest:///?componentSupplier=KttmNestedComponentSupplier
!set outputformat mysql
# Wed Jul 10 19:11:28 IST 2024
SELECT
MAX(CAST(t."__time" AS TIMESTAMP)) AS "__VALUE__"
FROM "kttm_nested" AS t
GROUP BY ();
+-------------------------+
| __VALUE__               |
+-------------------------+
| 2019-08-25 23:59:58.044 |
+-------------------------+
(1 row)

!ok
# Wed Jul 10 19:11:28 IST 2024
SELECT
MAX(CAST(t."__time" AS TIMESTAMP)) AS "__VALUE__"
FROM "kttm_nested" AS t
GROUP BY ();
+-------------------------+
| __VALUE__               |
+-------------------------+
| 2019-08-25 23:59:58.044 |
+-------------------------+
(1 row)

!ok
# Wed Jul 10 19:11:35 IST 2024
SELECT
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v0",
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-24 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 00:00:00'))) AS "v1"
FROM "kttm_nested" AS t
WHERE (TIMESTAMP '2019-08-24 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00')
GROUP BY ();
+------+----+
| v0   | v1 |
+------+----+
| 4519 |  0 |
+------+----+
(1 row)

!ok
# Wed Jul 10 19:11:38 IST 2024
SELECT
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v0",
(SUM(t."session_length") FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v1",
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-24 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 00:00:00'))) AS "v2",
(SUM(t."session_length") FILTER (WHERE (TIMESTAMP '2019-08-24 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 00:00:00'))) AS "v3"
FROM "kttm_nested" AS t
WHERE (TIMESTAMP '2019-08-24 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00')
GROUP BY ();
+------+------------+----+----+
| v0   | v1         | v2 | v3 |
+------+------------+----+----+
| 4519 | 2047513237 |  0 |    |
+------+------------+----+----+
(1 row)

!ok
# Wed Jul 10 19:11:41 IST 2024
SELECT
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v0",
(SUM(t."session_length") FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v1",
(SUM(t."timezone_offset") FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v2",
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-24 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 00:00:00'))) AS "v3",
(SUM(t."session_length") FILTER (WHERE (TIMESTAMP '2019-08-24 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 00:00:00'))) AS "v4",
(SUM(t."timezone_offset") FILTER (WHERE (TIMESTAMP '2019-08-24 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 00:00:00'))) AS "v5"
FROM "kttm_nested" AS t
WHERE (TIMESTAMP '2019-08-24 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00')
GROUP BY ();
+------+------------+--------+----+----+----+
| v0   | v1         | v2     | v3 | v4 | v5 |
+------+------------+--------+----+----+----+
| 4519 | 2047513237 | 672300 |  0 |    |    |
+------+------------+--------+----+----+----+
(1 row)

!ok
# Wed Jul 10 19:11:43 IST 2024
SELECT
(COUNT(*)) AS "count",
(SUM(t."session_length")) AS "sum_session_length",
(SUM(t."timezone_offset")) AS "sum_timezone_offset"
FROM "kttm_nested" AS t
WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00')
GROUP BY ();
+-------+--------------------+---------------------+
| count | sum_session_length | sum_timezone_offset |
+-------+--------------------+---------------------+
|  4519 |         2047513237 |              672300 |
+-------+--------------------+---------------------+
(1 row)

!ok
# Wed Jul 10 19:11:45 IST 2024
SELECT
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v0",
(SUM(t."session_length") FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v1",
(SUM(t."timezone_offset") FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v2",
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-24 23:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 23:00:00'))) AS "v3",
(SUM(t."session_length") FILTER (WHERE (TIMESTAMP '2019-08-24 23:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 23:00:00'))) AS "v4",
(SUM(t."timezone_offset") FILTER (WHERE (TIMESTAMP '2019-08-24 23:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 23:00:00'))) AS "v5"
FROM "kttm_nested" AS t
WHERE (TIMESTAMP '2019-08-24 23:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00')
GROUP BY ();
+------+------------+--------+------+------------+--------+
| v0   | v1         | v2     | v3   | v4         | v5     |
+------+------------+--------+------+------------+--------+
| 4519 | 2047513237 | 672300 | 4336 | 1980646611 | 640680 |
+------+------------+--------+------+------------+--------+
(1 row)

!ok
# Wed Jul 10 19:12:25 IST 2024
SELECT
TIME_FLOOR(CAST(t."__time" AS TIMESTAMP), 'PT6H', NULL, 'Etc/UTC') AS "__time",
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-25 00:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "count",
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-24 23:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 23:00:00'))) AS "_cmp_count",
21600000 AS "MillisecondsInInterval"
FROM "kttm_nested" AS t
WHERE (TIMESTAMP '2019-08-24 23:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00')
GROUP BY 1
ORDER BY "__time" DESC
LIMIT 101;
+-------------------------+-------+------------+------------------------+
| __time                  | count | _cmp_count | MillisecondsInInterval |
+-------------------------+-------+------------+------------------------+
| 2019-08-25 18:00:00.000 |  2027 |       1844 |               21600000 |
| 2019-08-25 12:00:00.000 |  1445 |       1445 |               21600000 |
| 2019-08-25 06:00:00.000 |   366 |        366 |               21600000 |
| 2019-08-25 00:00:00.000 |   681 |        681 |               21600000 |
+-------------------------+-------+------------+------------------------+
(4 rows)

!ok
# Wed Jul 10 19:12:27 IST 2024
SELECT
TIME_FLOOR(CAST(t."__time" AS TIMESTAMP), 'PT1H', NULL, 'Etc/UTC') AS "__time",
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-25 18:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "count",
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-25 17:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 23:00:00'))) AS "_cmp_count",
3600000 AS "MillisecondsInInterval"
FROM "kttm_nested" AS t
WHERE (TIMESTAMP '2019-08-25 17:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00')
GROUP BY 1
ORDER BY "__time" DESC
LIMIT 101;
+-------------------------+-------+------------+------------------------+
| __time                  | count | _cmp_count | MillisecondsInInterval |
+-------------------------+-------+------------+------------------------+
| 2019-08-25 23:00:00.000 |   183 |          0 |                3600000 |
| 2019-08-25 22:00:00.000 |   213 |        213 |                3600000 |
| 2019-08-25 21:00:00.000 |   263 |        263 |                3600000 |
| 2019-08-25 20:00:00.000 |   392 |        392 |                3600000 |
| 2019-08-25 19:00:00.000 |   491 |        491 |                3600000 |
| 2019-08-25 18:00:00.000 |   485 |        485 |                3600000 |
| 2019-08-25 17:00:00.000 |     0 |        556 |                3600000 |
+-------------------------+-------+------------+------------------------+
(7 rows)

!ok
# Wed Jul 10 19:12:27 IST 2024
SELECT
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-25 18:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v0",
(SUM(t."session_length") FILTER (WHERE (TIMESTAMP '2019-08-25 18:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v1",
(SUM(t."timezone_offset") FILTER (WHERE (TIMESTAMP '2019-08-25 18:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00'))) AS "v2",
(COUNT(*) FILTER (WHERE (TIMESTAMP '2019-08-25 17:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 23:00:00'))) AS "v3",
(SUM(t."session_length") FILTER (WHERE (TIMESTAMP '2019-08-25 17:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 23:00:00'))) AS "v4",
(SUM(t."timezone_offset") FILTER (WHERE (TIMESTAMP '2019-08-25 17:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-25 23:00:00'))) AS "v5"
FROM "kttm_nested" AS t
WHERE (TIMESTAMP '2019-08-25 17:00:00'<=CAST(t."__time" AS TIMESTAMP) AND CAST(t."__time" AS TIMESTAMP)<TIMESTAMP '2019-08-26 00:00:00')
GROUP BY ();
+------+-----------+--------+------+-----------+--------+
| v0   | v1        | v2     | v3   | v4        | v5     |
+------+-----------+--------+------+-----------+--------+
| 2027 | 915123211 | 377460 | 2400 | 892812031 | 468270 |
+------+-----------+--------+------+-----------+--------+
(1 row)

!ok
