!set useApproximateCountDistinct false
!use druidtest://?componentSupplier=AllDruidEnginesComponentSupplier&datasets=sql/src/test/quidem/qatests/qaJsonCols/funcs_and_sql
!set outputformat mysql
#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: SEL_DATASOURCE
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_json_cols;
+-----+
| cnt |
+-----+
|   4 |
+-----+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A001
#-------------------------------------------------------------------------
SELECT json_paths(__time) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A002
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(__time) IS NOT NULL;
+---+
| c |
+---+
| 4 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A003
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(__time) IS NULL;
+---+
| c |
+---+
| 0 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A004
#-------------------------------------------------------------------------
SELECT json_paths('ABCD') c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A005
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths('ABCD') IS NOT NULL;
+---+
| c |
+---+
| 4 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A006
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths('ABCD') IS NULL;
+---+
| c |
+---+
| 0 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A007
#-------------------------------------------------------------------------
SELECT json_paths(s_str) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A008
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(s_str) IS NOT NULL;
+---+
| c |
+---+
| 4 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A009
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(s_str) IS NULL;
+---+
| c |
+---+
| 0 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A010
#-------------------------------------------------------------------------
SELECT json_paths(1234) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A011
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(1234) IS NOT NULL;
+---+
| c |
+---+
| 4 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A012
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(1234) IS NULL;
+---+
| c |
+---+
| 0 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A013
#-------------------------------------------------------------------------
SELECT json_paths(s_num_int) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A014
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(s_num_int) IS NOT NULL;
+---+
| c |
+---+
| 4 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A015
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(s_num_int) IS NULL;
+---+
| c |
+---+
| 0 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A016
#-------------------------------------------------------------------------
SELECT json_paths(1234.5678) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A017
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(1234.5678) IS NOT NULL;
+---+
| c |
+---+
| 4 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A018
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(1234.5678) IS NULL;
+---+
| c |
+---+
| 0 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A019
#-------------------------------------------------------------------------
SELECT json_paths(s_num_float) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A020
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(s_num_float) IS NOT NULL;
+---+
| c |
+---+
| 4 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A021
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(s_num_float) IS NULL;
+---+
| c |
+---+
| 0 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A022
#-------------------------------------------------------------------------
SELECT json_paths(NULL) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A023
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(NULL) IS NULL;
+---+
| c |
+---+
| 0 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A024
#-------------------------------------------------------------------------
SELECT count(*) c
FROM test_json_cols
WHERE json_paths(NULL) IS NOT NULL;
+---+
| c |
+---+
| 4 |
+---+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A025
#-------------------------------------------------------------------------
SELECT json_paths(json_query(s_str, '$')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A026
#-------------------------------------------------------------------------
SELECT json_paths(json_query(s_num_int, '$')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A027
#-------------------------------------------------------------------------
SELECT json_paths(json_query(s_num_float, '$')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A028
#-------------------------------------------------------------------------
SELECT json_paths(json_query(s_null, '$')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A029
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c_empty_obj, '$')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| []  |
| []  |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A030
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c_empty_array, '$')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A031
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c_empty_obj_nested, '$')) c
FROM test_json_cols;
+--------------+
| c            |
+--------------+
| [$.o2, $.o3] |
| [$.o2, $.o3] |
| [$]          |
| [$]          |
+--------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A032
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c_empty_array_nested, '$')) c
FROM test_json_cols;
+--------------+
| c            |
+--------------+
| [$[2], $[1]] |
| [$[2], $[1]] |
| [$]          |
| [$]          |
+--------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A033
#-------------------------------------------------------------------------
SELECT array_length(json_paths(c1)) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| 130 |
| 130 |
| 130 |
| 130 |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A034
#-------------------------------------------------------------------------
SELECT array_length(json_paths(json_query(c1, '$.a_obj'))) c
FROM test_json_cols;
+----+
| c  |
+----+
|  1 |
|  1 |
| 40 |
| 40 |
+----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A035
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_str')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A036
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_num_int')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A037
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_num_float')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A038
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_null')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A039
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_empty_obj')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| []  |
| []  |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A040
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_empty_array')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A041
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_empty_obj_nested')) c
FROM test_json_cols;
+--------------+
| c            |
+--------------+
| [$.o2, $.o3] |
| [$.o2, $.o3] |
| [$]          |
| [$]          |
+--------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A042
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_empty_array_nested')) c
FROM test_json_cols;
+--------------+
| c            |
+--------------+
| [$[2], $[1]] |
| [$[2], $[1]] |
| [$]          |
| [$]          |
+--------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A043
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_obj')) c
FROM test_json_cols;
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| c                                                                                                                                                                                  |
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| [$.a_str, $.a_empty_array, $.a_null, $.a_num_int, $.a_bool, $.a_empty_array_nested[1], $.a_empty_array_nested[2], $.a_empty_obj_nested.o2, $.a_num_float, $.a_empty_obj_nested.o3] |
| [$.a_str, $.a_empty_array, $.a_null, $.a_num_int, $.a_bool, $.a_empty_array_nested[1], $.a_empty_array_nested[2], $.a_empty_obj_nested.o2, $.a_num_float, $.a_empty_obj_nested.o3] |
| [$]                                                                                                                                                                                |
| [$]                                                                                                                                                                                |
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A044
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_array')) c
FROM test_json_cols;
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| c                                                                                                                                                                                                                                                                                                                                                                                                                                |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| [$[0].a_bool, $[1].a_num_int, $[0].a_num_int, $[1].a_bool, $[1].a_num_float, $[0].a_num_float, $[1].a_empty_array, $[0].a_empty_array, $[1].a_str, $[1].a_null, $[0].a_null, $[0].a_str, $[1].a_empty_array_nested[2], $[0].a_empty_obj_nested.o3, $[1].a_empty_obj_nested.o2, $[0].a_empty_obj_nested.o2, $[1].a_empty_obj_nested.o3, $[0].a_empty_array_nested[2], $[1].a_empty_array_nested[1], $[0].a_empty_array_nested[1]] |
| [$[0].a_bool, $[1].a_num_int, $[0].a_num_int, $[1].a_bool, $[1].a_num_float, $[0].a_num_float, $[1].a_empty_array, $[0].a_empty_array, $[1].a_str, $[1].a_null, $[0].a_null, $[0].a_str, $[1].a_empty_array_nested[2], $[0].a_empty_obj_nested.o3, $[1].a_empty_obj_nested.o2, $[0].a_empty_obj_nested.o2, $[1].a_empty_obj_nested.o3, $[0].a_empty_array_nested[2], $[1].a_empty_array_nested[1], $[0].a_empty_array_nested[1]] |
| [$]                                                                                                                                                                                                                                                                                                                                                                                                                              |
| [$]                                                                                                                                                                                                                                                                                                                                                                                                                              |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A045
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_array[0]')) c
FROM test_json_cols;
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| c                                                                                                                                                                                  |
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| [$.a_str, $.a_empty_array, $.a_null, $.a_num_int, $.a_bool, $.a_empty_array_nested[1], $.a_empty_array_nested[2], $.a_empty_obj_nested.o2, $.a_num_float, $.a_empty_obj_nested.o3] |
| [$.a_str, $.a_empty_array, $.a_null, $.a_num_int, $.a_bool, $.a_empty_array_nested[1], $.a_empty_array_nested[2], $.a_empty_obj_nested.o2, $.a_num_float, $.a_empty_obj_nested.o3] |
| [$]                                                                                                                                                                                |
| [$]                                                                                                                                                                                |
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A046
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_array[0].a_str')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A047
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_array[0].a_num_int')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A048
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_array[0].a_num_float')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_paths TEST_ID: A049
#-------------------------------------------------------------------------
SELECT json_paths(json_query(c1, '$.a_obj.a_array[0].a_null')) c
FROM test_json_cols;
+-----+
| c   |
+-----+
| [$] |
| [$] |
| [$] |
| [$] |
+-----+
(4 rows)

!ok

