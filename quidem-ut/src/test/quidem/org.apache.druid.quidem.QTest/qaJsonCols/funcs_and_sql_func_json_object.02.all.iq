!set useApproximateCountDistinct false
!use druidtest://?componentSupplier=AllDruidEnginesComponentSupplier&datasets=sql/src/test/quidem/qatests/qaJsonCols/funcs_and_sql
!set outputformat mysql
#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A050
#-------------------------------------------------------------------------
SELECT json_object(c1:'A') c
FROM test_json_cols;
field name must be a STRING
!error

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A051
#-------------------------------------------------------------------------
SELECT json_object(KEY json_query(c1, '$.a_array[0].a_obj') value 'A') c
FROM test_json_cols;
field name must be a STRING
!error

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A052
#-------------------------------------------------------------------------
SELECT json_object(json_query(c1, '$.a_array[0].a_obj'):'A') c
FROM test_json_cols;
field name must be a STRING
!error

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A053
#-------------------------------------------------------------------------
SELECT json_object(KEY json_object(KEY c2 value 'B') value 'A') c
FROM test_json_cols;
field name must be a STRING
!error

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A054
#-------------------------------------------------------------------------
SELECT json_object(json_object(KEY c2 value 'B'):'A') c
FROM test_json_cols;
field name must be a STRING
!error

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A055
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value 'A') c
FROM test_json_cols;
+-----------+
| c         |
+-----------+
| {"a":"A"} |
| {"a":"A"} |
| {"a":"A"} |
| {"a":"A"} |
+-----------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A056
#-------------------------------------------------------------------------
SELECT json_object('a':'A') c
FROM test_json_cols;
+-----------+
| c         |
+-----------+
| {"a":"A"} |
| {"a":"A"} |
| {"a":"A"} |
| {"a":"A"} |
+-----------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A057
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value '123') c
FROM test_json_cols;
+-------------+
| c           |
+-------------+
| {"a":"123"} |
| {"a":"123"} |
| {"a":"123"} |
| {"a":"123"} |
+-------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A058
#-------------------------------------------------------------------------
SELECT json_object('a':'123') c
FROM test_json_cols;
+-------------+
| c           |
+-------------+
| {"a":"123"} |
| {"a":"123"} |
| {"a":"123"} |
| {"a":"123"} |
+-------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A059
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value '日本') c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":"日本"} |
| {"a":"日本"} |
| {"a":"日本"} |
| {"a":"日本"} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A060
#-------------------------------------------------------------------------
SELECT json_object('a':'日本') c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":"日本"} |
| {"a":"日本"} |
| {"a":"日本"} |
| {"a":"日本"} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A061
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value 'a'||'b'||'c') c
FROM test_json_cols;
+-------------+
| c           |
+-------------+
| {"a":"abc"} |
| {"a":"abc"} |
| {"a":"abc"} |
| {"a":"abc"} |
+-------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A062
#-------------------------------------------------------------------------
SELECT json_object('a':'a'||'b'||'c') c
FROM test_json_cols;
+-------------+
| c           |
+-------------+
| {"a":"abc"} |
| {"a":"abc"} |
| {"a":"abc"} |
| {"a":"abc"} |
+-------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A063
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value '"This is My Key"') c
FROM test_json_cols;
+----------------------------+
| c                          |
+----------------------------+
| {"a":"\"This is My Key\""} |
| {"a":"\"This is My Key\""} |
| {"a":"\"This is My Key\""} |
| {"a":"\"This is My Key\""} |
+----------------------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A064
#-------------------------------------------------------------------------
SELECT json_object('a':'"This is My Key"') c
FROM test_json_cols;
+----------------------------+
| c                          |
+----------------------------+
| {"a":"\"This is My Key\""} |
| {"a":"\"This is My Key\""} |
| {"a":"\"This is My Key\""} |
| {"a":"\"This is My Key\""} |
+----------------------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A065
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value json_value(s_str, '$')) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":"A"}  |
| {"a":"A"}  |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A066
#-------------------------------------------------------------------------
SELECT json_object('a':json_value(s_str, '$')) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":"A"}  |
| {"a":"A"}  |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A067
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value 123) c
FROM test_json_cols;
+-----------+
| c         |
+-----------+
| {"a":123} |
| {"a":123} |
| {"a":123} |
| {"a":123} |
+-----------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A068
#-------------------------------------------------------------------------
SELECT json_object('a':123) c
FROM test_json_cols;
+-----------+
| c         |
+-----------+
| {"a":123} |
| {"a":123} |
| {"a":123} |
| {"a":123} |
+-----------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A069
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value 1+1) c
FROM test_json_cols;
+---------+
| c       |
+---------+
| {"a":2} |
| {"a":2} |
| {"a":2} |
| {"a":2} |
+---------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A070
#-------------------------------------------------------------------------
SELECT json_object('a':1+1) c
FROM test_json_cols;
+---------+
| c       |
+---------+
| {"a":2} |
| {"a":2} |
| {"a":2} |
| {"a":2} |
+---------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A071
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value json_value(s_num_int, '$' RETURNING bigint)) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":1}    |
| {"a":1}    |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A072
#-------------------------------------------------------------------------
SELECT json_object('a':json_value(s_num_int, '$' RETURNING bigint)) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":1}    |
| {"a":1}    |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A073
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value 0.123) c
FROM test_json_cols;
+-------------+
| c           |
+-------------+
| {"a":0.123} |
| {"a":0.123} |
| {"a":0.123} |
| {"a":0.123} |
+-------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A074
#-------------------------------------------------------------------------
SELECT json_object('a':0.123) c
FROM test_json_cols;
+-------------+
| c           |
+-------------+
| {"a":0.123} |
| {"a":0.123} |
| {"a":0.123} |
| {"a":0.123} |
+-------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A075
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value 0.1+0.1) c
FROM test_json_cols;
+-----------+
| c         |
+-----------+
| {"a":0.2} |
| {"a":0.2} |
| {"a":0.2} |
| {"a":0.2} |
+-----------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A076
#-------------------------------------------------------------------------
SELECT json_object('a':0.1+0.1) c
FROM test_json_cols;
+-----------+
| c         |
+-----------+
| {"a":0.2} |
| {"a":0.2} |
| {"a":0.2} |
| {"a":0.2} |
+-----------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A077
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value json_value(s_num_float, '$' RETURNING DOUBLE)) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":0.1}  |
| {"a":0.1}  |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A078
#-------------------------------------------------------------------------
SELECT json_object('a':json_value(s_num_float, '$' RETURNING DOUBLE)) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":0.1}  |
| {"a":0.1}  |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A079
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value TRUE) c
FROM test_json_cols;
+---------+
| c       |
+---------+
| {"a":1} |
| {"a":1} |
| {"a":1} |
| {"a":1} |
+---------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A080
#-------------------------------------------------------------------------
SELECT json_object('a':true) c
FROM test_json_cols;
+---------+
| c       |
+---------+
| {"a":1} |
| {"a":1} |
| {"a":1} |
| {"a":1} |
+---------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A081
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value (1=2)) c
FROM test_json_cols;
+---------+
| c       |
+---------+
| {"a":0} |
| {"a":0} |
| {"a":0} |
| {"a":0} |
+---------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A082
#-------------------------------------------------------------------------
SELECT json_object('a':(1=2)) c
FROM test_json_cols;
+---------+
| c       |
+---------+
| {"a":0} |
| {"a":0} |
| {"a":0} |
| {"a":0} |
+---------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A083
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value json_value(s_bool, '$' RETURNING boolean)) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":1}    |
| {"a":1}    |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A084
#-------------------------------------------------------------------------
SELECT json_object('a':json_value(s_bool, '$' RETURNING boolean)) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":1}    |
| {"a":1}    |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A085
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value NULL) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":null} |
| {"a":null} |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A086
#-------------------------------------------------------------------------
SELECT json_object('a':null) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":null} |
| {"a":null} |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A087
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value json_value(s_null, '$')) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":null} |
| {"a":null} |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A088
#-------------------------------------------------------------------------
SELECT json_object('a':json_value(s_null, '$')) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":null} |
| {"a":null} |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A089
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value json_value(c1, '$.doesnotexist')) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":null} |
| {"a":null} |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A090
#-------------------------------------------------------------------------
SELECT json_object('a':json_value(c1, '$.doesnotexist')) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":null} |
| {"a":null} |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A091
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value __time) c
FROM test_json_cols;
+---------------------+
| c                   |
+---------------------+
| {"a":1640995200000} |
| {"a":1640995200000} |
| {"a":1643673600000} |
| {"a":1643673600000} |
+---------------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A092
#-------------------------------------------------------------------------
SELECT json_object('a':__time) c
FROM test_json_cols;
+---------------------+
| c                   |
+---------------------+
| {"a":1640995200000} |
| {"a":1640995200000} |
| {"a":1643673600000} |
| {"a":1643673600000} |
+---------------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A093
#-------------------------------------------------------------------------
SELECT count(*)
FROM
  (SELECT json_object(KEY 'a' value CURRENT_TIMESTAMP) c
   FROM test_json_cols);
+--------+
| EXPR$0 |
+--------+
|      4 |
+--------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A094
#-------------------------------------------------------------------------
SELECT count(*)
FROM
  (SELECT json_object('a':current_timestamp) c
   FROM test_json_cols);
+--------+
| EXPR$0 |
+--------+
|      4 |
+--------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A095
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value c_empty_obj) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":null} |
| {"a":null} |
| {"a":{}}   |
| {"a":{}}   |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A096
#-------------------------------------------------------------------------
SELECT json_object('a':c_empty_obj) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":null} |
| {"a":null} |
| {"a":{}}   |
| {"a":{}}   |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A097
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value c_empty_array) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":[]}   |
| {"a":[]}   |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A098
#-------------------------------------------------------------------------
SELECT json_object('a':c_empty_array) c
FROM test_json_cols;
+------------+
| c          |
+------------+
| {"a":[]}   |
| {"a":[]}   |
| {"a":null} |
| {"a":null} |
+------------+
(4 rows)

!ok

#-------------------------------------------------------------------------
# TESTCASE: test_func_json_object TEST_ID: A099
#-------------------------------------------------------------------------
SELECT json_object(KEY 'a' value c_empty_obj_nested) c
FROM test_json_cols;
+-----------------------------------+
| c                                 |
+-----------------------------------+
| {"a":null}                        |
| {"a":null}                        |
| {"a":{"o1":{},"o2":[],"o3":null}} |
| {"a":{"o1":{},"o2":[],"o3":null}} |
+-----------------------------------+
(4 rows)

!ok

