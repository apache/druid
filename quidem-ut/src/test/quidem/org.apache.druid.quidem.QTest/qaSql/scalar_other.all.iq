!set useApproximateCountDistinct false
!use druidtest://?componentSupplier=AllDruidEnginesComponentSupplier&datasets=sql/src/test/quidem/qatests/qaSql
!set outputformat mysql
#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: SEL_DATASOURCE
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00';
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A1_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||(CASE client_ip
                 WHEN server_ip THEN session_length
                 ELSE session_length+1
             END) IS NULL
       OR ('1'||(CASE client_ip
                     WHEN server_ip THEN session_length
                     ELSE session_length+1
                 END) = 1||(CASE client_ip
                                WHEN server_ip THEN session_length
                                ELSE session_length+1
                            END)
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) IS NOT DISTINCT
           FROM 1||(CASE client_ip
                        WHEN server_ip THEN session_length
                        ELSE session_length+1
                    END)
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) <> '0'||(CASE client_ip
                                       WHEN server_ip THEN session_length
                                       ELSE session_length+1
                                   END)
           AND ('1'||(CASE client_ip
                          WHEN server_ip THEN session_length
                          ELSE session_length+1
                      END) IS DISTINCT
                FROM '0'||(CASE client_ip
                               WHEN server_ip THEN session_length
                               ELSE session_length+1
                           END))
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) > '0'||(CASE client_ip
                                      WHEN server_ip THEN session_length
                                      ELSE session_length+1
                                  END)
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) >= '0'||(CASE client_ip
                                       WHEN server_ip THEN session_length
                                       ELSE session_length+1
                                   END)
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) < 2||(CASE client_ip
                                    WHEN server_ip THEN session_length
                                    ELSE session_length+1
                                END)
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) <= 2||(CASE client_ip
                                     WHEN server_ip THEN session_length
                                     ELSE session_length+1
                                 END)
           AND ('1'||(CASE client_ip
                          WHEN server_ip THEN session_length
                          ELSE session_length+1
                      END) <> '0'||(CASE client_ip
                                        WHEN server_ip THEN session_length
                                        ELSE session_length+1
                                    END)) IS TRUE
           AND ('1'||(CASE client_ip
                          WHEN server_ip THEN session_length
                          ELSE session_length+1
                      END) = '0'||(CASE client_ip
                                       WHEN server_ip THEN session_length
                                       ELSE session_length+1
                                   END)) IS NOT TRUE
           AND ('1'||(CASE client_ip
                          WHEN server_ip THEN session_length
                          ELSE session_length+1
                      END) = '0'||(CASE client_ip
                                       WHEN server_ip THEN session_length
                                       ELSE session_length+1
                                   END)) IS FALSE
           AND ('1'||(CASE client_ip
                          WHEN server_ip THEN session_length
                          ELSE session_length+1
                      END) <> '0'||(CASE client_ip
                                        WHEN server_ip THEN session_length
                                        ELSE session_length+1
                                    END)) IS NOT FALSE
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) BETWEEN '0'||(CASE client_ip
                                            WHEN server_ip THEN session_length
                                            ELSE session_length+1
                                        END) AND 2||(CASE client_ip
                                                         WHEN server_ip THEN session_length
                                                         ELSE session_length+1
                                                     END)
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) NOT BETWEEN '1'||(CASE client_ip
                                                WHEN server_ip THEN session_length
                                                ELSE session_length+1
                                            END) AND '0'||(CASE client_ip
                                                               WHEN server_ip THEN session_length
                                                               ELSE session_length+1
                                                           END)
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) like '%'
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) not like '__DOES_NOT_EXIST__%'
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) IN ('0'||(CASE client_ip
                                        WHEN server_ip THEN session_length
                                        ELSE session_length+1
                                    END),
                              1||(CASE client_ip
                                      WHEN server_ip THEN session_length
                                      ELSE session_length+1
                                  END),
                              2||(CASE client_ip
                                      WHEN server_ip THEN session_length
                                      ELSE session_length+1
                                  END))
           AND '1'||(CASE client_ip
                         WHEN server_ip THEN session_length
                         ELSE session_length+1
                     END) NOT IN ('0'||(CASE client_ip
                                            WHEN server_ip THEN session_length
                                            ELSE session_length+1
                                        END),
                                  2||(CASE client_ip
                                          WHEN server_ip THEN session_length
                                          ELSE session_length+1
                                      END)))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A1_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||(CASE client_ip
                 WHEN server_ip THEN session_length
                 ELSE session_length+1
             END) IS NULL
       OR '1'||(CASE client_ip
                    WHEN server_ip THEN session_length
                    ELSE session_length+1
                END) IN
         (SELECT '1'||(CASE client_ip
                           WHEN server_ip THEN session_length
                           ELSE session_length+1
                       END)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||(CASE client_ip
                           WHEN server_ip THEN session_length
                           ELSE session_length+1
                       END) IS NULL
                 OR ('1'||(CASE client_ip
                               WHEN server_ip THEN session_length
                               ELSE session_length+1
                           END) = 1||(CASE client_ip
                                          WHEN server_ip THEN session_length
                                          ELSE session_length+1
                                      END)
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) IS NOT DISTINCT
                     FROM 1||(CASE client_ip
                                  WHEN server_ip THEN session_length
                                  ELSE session_length+1
                              END)
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) <> '0'||(CASE client_ip
                                                 WHEN server_ip THEN session_length
                                                 ELSE session_length+1
                                             END)
                     AND ('1'||(CASE client_ip
                                    WHEN server_ip THEN session_length
                                    ELSE session_length+1
                                END) IS DISTINCT
                          FROM '0'||(CASE client_ip
                                         WHEN server_ip THEN session_length
                                         ELSE session_length+1
                                     END))
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) > '0'||(CASE client_ip
                                                WHEN server_ip THEN session_length
                                                ELSE session_length+1
                                            END)
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) >= '0'||(CASE client_ip
                                                 WHEN server_ip THEN session_length
                                                 ELSE session_length+1
                                             END)
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) < 2||(CASE client_ip
                                              WHEN server_ip THEN session_length
                                              ELSE session_length+1
                                          END)
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) <= 2||(CASE client_ip
                                               WHEN server_ip THEN session_length
                                               ELSE session_length+1
                                           END)
                     AND ('1'||(CASE client_ip
                                    WHEN server_ip THEN session_length
                                    ELSE session_length+1
                                END) <> '0'||(CASE client_ip
                                                  WHEN server_ip THEN session_length
                                                  ELSE session_length+1
                                              END)) IS TRUE
                     AND ('1'||(CASE client_ip
                                    WHEN server_ip THEN session_length
                                    ELSE session_length+1
                                END) = '0'||(CASE client_ip
                                                 WHEN server_ip THEN session_length
                                                 ELSE session_length+1
                                             END)) IS NOT TRUE
                     AND ('1'||(CASE client_ip
                                    WHEN server_ip THEN session_length
                                    ELSE session_length+1
                                END) = '0'||(CASE client_ip
                                                 WHEN server_ip THEN session_length
                                                 ELSE session_length+1
                                             END)) IS FALSE
                     AND ('1'||(CASE client_ip
                                    WHEN server_ip THEN session_length
                                    ELSE session_length+1
                                END) <> '0'||(CASE client_ip
                                                  WHEN server_ip THEN session_length
                                                  ELSE session_length+1
                                              END)) IS NOT FALSE
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) BETWEEN '0'||(CASE client_ip
                                                      WHEN server_ip THEN session_length
                                                      ELSE session_length+1
                                                  END) AND 2||(CASE client_ip
                                                                   WHEN server_ip THEN session_length
                                                                   ELSE session_length+1
                                                               END)
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) NOT BETWEEN '1'||(CASE client_ip
                                                          WHEN server_ip THEN session_length
                                                          ELSE session_length+1
                                                      END) AND '0'||(CASE client_ip
                                                                         WHEN server_ip THEN session_length
                                                                         ELSE session_length+1
                                                                     END)
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) like '%'
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) not like '__DOES_NOT_EXIST__%'
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) IN ('0'||(CASE client_ip
                                                  WHEN server_ip THEN session_length
                                                  ELSE session_length+1
                                              END),
                                        1||(CASE client_ip
                                                WHEN server_ip THEN session_length
                                                ELSE session_length+1
                                            END),
                                        2||(CASE client_ip
                                                WHEN server_ip THEN session_length
                                                ELSE session_length+1
                                            END))
                     AND '1'||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END) NOT IN ('0'||(CASE client_ip
                                                      WHEN server_ip THEN session_length
                                                      ELSE session_length+1
                                                  END),
                                            2||(CASE client_ip
                                                    WHEN server_ip THEN session_length
                                                    ELSE session_length+1
                                                END))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A1_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||(CASE client_ip
                                    WHEN server_ip THEN session_length
                                    ELSE session_length+1
                                END),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||(CASE client_ip
                    WHEN server_ip THEN session_length
                    ELSE session_length+1
                END) IS NULL
          OR ('1'||(CASE client_ip
                        WHEN server_ip THEN session_length
                        ELSE session_length+1
                    END) = 1||(CASE client_ip
                                   WHEN server_ip THEN session_length
                                   ELSE session_length+1
                               END)
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) IS NOT DISTINCT
              FROM 1||(CASE client_ip
                           WHEN server_ip THEN session_length
                           ELSE session_length+1
                       END)
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) <> '0'||(CASE client_ip
                                          WHEN server_ip THEN session_length
                                          ELSE session_length+1
                                      END)
              AND ('1'||(CASE client_ip
                             WHEN server_ip THEN session_length
                             ELSE session_length+1
                         END) IS DISTINCT
                   FROM '0'||(CASE client_ip
                                  WHEN server_ip THEN session_length
                                  ELSE session_length+1
                              END))
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) > '0'||(CASE client_ip
                                         WHEN server_ip THEN session_length
                                         ELSE session_length+1
                                     END)
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) >= '0'||(CASE client_ip
                                          WHEN server_ip THEN session_length
                                          ELSE session_length+1
                                      END)
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) < 2||(CASE client_ip
                                       WHEN server_ip THEN session_length
                                       ELSE session_length+1
                                   END)
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) <= 2||(CASE client_ip
                                        WHEN server_ip THEN session_length
                                        ELSE session_length+1
                                    END)
              AND ('1'||(CASE client_ip
                             WHEN server_ip THEN session_length
                             ELSE session_length+1
                         END) <> '0'||(CASE client_ip
                                           WHEN server_ip THEN session_length
                                           ELSE session_length+1
                                       END)) IS TRUE
              AND ('1'||(CASE client_ip
                             WHEN server_ip THEN session_length
                             ELSE session_length+1
                         END) = '0'||(CASE client_ip
                                          WHEN server_ip THEN session_length
                                          ELSE session_length+1
                                      END)) IS NOT TRUE
              AND ('1'||(CASE client_ip
                             WHEN server_ip THEN session_length
                             ELSE session_length+1
                         END) = '0'||(CASE client_ip
                                          WHEN server_ip THEN session_length
                                          ELSE session_length+1
                                      END)) IS FALSE
              AND ('1'||(CASE client_ip
                             WHEN server_ip THEN session_length
                             ELSE session_length+1
                         END) <> '0'||(CASE client_ip
                                           WHEN server_ip THEN session_length
                                           ELSE session_length+1
                                       END)) IS NOT FALSE
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) BETWEEN '0'||(CASE client_ip
                                               WHEN server_ip THEN session_length
                                               ELSE session_length+1
                                           END) AND 2||(CASE client_ip
                                                            WHEN server_ip THEN session_length
                                                            ELSE session_length+1
                                                        END)
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) NOT BETWEEN '1'||(CASE client_ip
                                                   WHEN server_ip THEN session_length
                                                   ELSE session_length+1
                                               END) AND '0'||(CASE client_ip
                                                                  WHEN server_ip THEN session_length
                                                                  ELSE session_length+1
                                                              END)
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) like '%'
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) not like '__DOES_NOT_EXIST__%'
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) IN ('0'||(CASE client_ip
                                           WHEN server_ip THEN session_length
                                           ELSE session_length+1
                                       END),
                                 1||(CASE client_ip
                                         WHEN server_ip THEN session_length
                                         ELSE session_length+1
                                     END),
                                 2||(CASE client_ip
                                         WHEN server_ip THEN session_length
                                         ELSE session_length+1
                                     END))
              AND '1'||(CASE client_ip
                            WHEN server_ip THEN session_length
                            ELSE session_length+1
                        END) NOT IN ('0'||(CASE client_ip
                                               WHEN server_ip THEN session_length
                                               ELSE session_length+1
                                           END),
                                     2||(CASE client_ip
                                             WHEN server_ip THEN session_length
                                             ELSE session_length+1
                                         END))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A2_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||(CASE session_length
                 WHEN session_length+1 THEN json_value(agent, '$.browser')
                 ELSE json_value(agent, '$.browser_version')
             END) IS NULL
       OR ('1'||(CASE session_length
                     WHEN session_length+1 THEN json_value(agent, '$.browser')
                     ELSE json_value(agent, '$.browser_version')
                 END) = 1||(CASE session_length
                                WHEN session_length+1 THEN json_value(agent, '$.browser')
                                ELSE json_value(agent, '$.browser_version')
                            END)
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) IS NOT DISTINCT
           FROM 1||(CASE session_length
                        WHEN session_length+1 THEN json_value(agent, '$.browser')
                        ELSE json_value(agent, '$.browser_version')
                    END)
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) <> '0'||(CASE session_length
                                       WHEN session_length+1 THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)
           AND ('1'||(CASE session_length
                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) IS DISTINCT
                FROM '0'||(CASE session_length
                               WHEN session_length+1 THEN json_value(agent, '$.browser')
                               ELSE json_value(agent, '$.browser_version')
                           END))
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) > '0'||(CASE session_length
                                      WHEN session_length+1 THEN json_value(agent, '$.browser')
                                      ELSE json_value(agent, '$.browser_version')
                                  END)
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) >= '0'||(CASE session_length
                                       WHEN session_length+1 THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) < 2||(CASE session_length
                                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END)
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) <= 2||(CASE session_length
                                     WHEN session_length+1 THEN json_value(agent, '$.browser')
                                     ELSE json_value(agent, '$.browser_version')
                                 END)
           AND ('1'||(CASE session_length
                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) <> '0'||(CASE session_length
                                        WHEN session_length+1 THEN json_value(agent, '$.browser')
                                        ELSE json_value(agent, '$.browser_version')
                                    END)) IS TRUE
           AND ('1'||(CASE session_length
                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) = '0'||(CASE session_length
                                       WHEN session_length+1 THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)) IS NOT TRUE
           AND ('1'||(CASE session_length
                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) = '0'||(CASE session_length
                                       WHEN session_length+1 THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)) IS FALSE
           AND ('1'||(CASE session_length
                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) <> '0'||(CASE session_length
                                        WHEN session_length+1 THEN json_value(agent, '$.browser')
                                        ELSE json_value(agent, '$.browser_version')
                                    END)) IS NOT FALSE
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) BETWEEN '0'||(CASE session_length
                                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                                            ELSE json_value(agent, '$.browser_version')
                                        END) AND 2||(CASE session_length
                                                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                         ELSE json_value(agent, '$.browser_version')
                                                     END)
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) NOT BETWEEN '1'||(CASE session_length
                                                WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                ELSE json_value(agent, '$.browser_version')
                                            END) AND '0'||(CASE session_length
                                                               WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                               ELSE json_value(agent, '$.browser_version')
                                                           END)
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) like '%'
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) not like '__DOES_NOT_EXIST__%'
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) IN ('0'||(CASE session_length
                                        WHEN session_length+1 THEN json_value(agent, '$.browser')
                                        ELSE json_value(agent, '$.browser_version')
                                    END),
                              1||(CASE session_length
                                      WHEN session_length+1 THEN json_value(agent, '$.browser')
                                      ELSE json_value(agent, '$.browser_version')
                                  END),
                              2||(CASE session_length
                                      WHEN session_length+1 THEN json_value(agent, '$.browser')
                                      ELSE json_value(agent, '$.browser_version')
                                  END))
           AND '1'||(CASE session_length
                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) NOT IN ('0'||(CASE session_length
                                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                                            ELSE json_value(agent, '$.browser_version')
                                        END),
                                  2||(CASE session_length
                                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A2_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||(CASE session_length
                 WHEN session_length+1 THEN json_value(agent, '$.browser')
                 ELSE json_value(agent, '$.browser_version')
             END) IS NULL
       OR '1'||(CASE session_length
                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                    ELSE json_value(agent, '$.browser_version')
                END) IN
         (SELECT '1'||(CASE session_length
                           WHEN session_length+1 THEN json_value(agent, '$.browser')
                           ELSE json_value(agent, '$.browser_version')
                       END)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||(CASE session_length
                           WHEN session_length+1 THEN json_value(agent, '$.browser')
                           ELSE json_value(agent, '$.browser_version')
                       END) IS NULL
                 OR ('1'||(CASE session_length
                               WHEN session_length+1 THEN json_value(agent, '$.browser')
                               ELSE json_value(agent, '$.browser_version')
                           END) = 1||(CASE session_length
                                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) IS NOT DISTINCT
                     FROM 1||(CASE session_length
                                  WHEN session_length+1 THEN json_value(agent, '$.browser')
                                  ELSE json_value(agent, '$.browser_version')
                              END)
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) <> '0'||(CASE session_length
                                                 WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                 ELSE json_value(agent, '$.browser_version')
                                             END)
                     AND ('1'||(CASE session_length
                                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) IS DISTINCT
                          FROM '0'||(CASE session_length
                                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                                         ELSE json_value(agent, '$.browser_version')
                                     END))
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) > '0'||(CASE session_length
                                                WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                ELSE json_value(agent, '$.browser_version')
                                            END)
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) >= '0'||(CASE session_length
                                                 WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                 ELSE json_value(agent, '$.browser_version')
                                             END)
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) < 2||(CASE session_length
                                              WHEN session_length+1 THEN json_value(agent, '$.browser')
                                              ELSE json_value(agent, '$.browser_version')
                                          END)
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) <= 2||(CASE session_length
                                               WHEN session_length+1 THEN json_value(agent, '$.browser')
                                               ELSE json_value(agent, '$.browser_version')
                                           END)
                     AND ('1'||(CASE session_length
                                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) <> '0'||(CASE session_length
                                                  WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                  ELSE json_value(agent, '$.browser_version')
                                              END)) IS TRUE
                     AND ('1'||(CASE session_length
                                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) = '0'||(CASE session_length
                                                 WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                 ELSE json_value(agent, '$.browser_version')
                                             END)) IS NOT TRUE
                     AND ('1'||(CASE session_length
                                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) = '0'||(CASE session_length
                                                 WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                 ELSE json_value(agent, '$.browser_version')
                                             END)) IS FALSE
                     AND ('1'||(CASE session_length
                                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) <> '0'||(CASE session_length
                                                  WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                  ELSE json_value(agent, '$.browser_version')
                                              END)) IS NOT FALSE
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) BETWEEN '0'||(CASE session_length
                                                      WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                      ELSE json_value(agent, '$.browser_version')
                                                  END) AND 2||(CASE session_length
                                                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                                   ELSE json_value(agent, '$.browser_version')
                                                               END)
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) NOT BETWEEN '1'||(CASE session_length
                                                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                          ELSE json_value(agent, '$.browser_version')
                                                      END) AND '0'||(CASE session_length
                                                                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                                         ELSE json_value(agent, '$.browser_version')
                                                                     END)
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) like '%'
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) not like '__DOES_NOT_EXIST__%'
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) IN ('0'||(CASE session_length
                                                  WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                  ELSE json_value(agent, '$.browser_version')
                                              END),
                                        1||(CASE session_length
                                                WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                ELSE json_value(agent, '$.browser_version')
                                            END),
                                        2||(CASE session_length
                                                WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                ELSE json_value(agent, '$.browser_version')
                                            END))
                     AND '1'||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) NOT IN ('0'||(CASE session_length
                                                      WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                      ELSE json_value(agent, '$.browser_version')
                                                  END),
                                            2||(CASE session_length
                                                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                    ELSE json_value(agent, '$.browser_version')
                                                END))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A2_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||(CASE session_length
                                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||(CASE session_length
                    WHEN session_length+1 THEN json_value(agent, '$.browser')
                    ELSE json_value(agent, '$.browser_version')
                END) IS NULL
          OR ('1'||(CASE session_length
                        WHEN session_length+1 THEN json_value(agent, '$.browser')
                        ELSE json_value(agent, '$.browser_version')
                    END) = 1||(CASE session_length
                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END)
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) IS NOT DISTINCT
              FROM 1||(CASE session_length
                           WHEN session_length+1 THEN json_value(agent, '$.browser')
                           ELSE json_value(agent, '$.browser_version')
                       END)
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) <> '0'||(CASE session_length
                                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)
              AND ('1'||(CASE session_length
                             WHEN session_length+1 THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) IS DISTINCT
                   FROM '0'||(CASE session_length
                                  WHEN session_length+1 THEN json_value(agent, '$.browser')
                                  ELSE json_value(agent, '$.browser_version')
                              END))
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) > '0'||(CASE session_length
                                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                                         ELSE json_value(agent, '$.browser_version')
                                     END)
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) >= '0'||(CASE session_length
                                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) < 2||(CASE session_length
                                       WHEN session_length+1 THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) <= 2||(CASE session_length
                                        WHEN session_length+1 THEN json_value(agent, '$.browser')
                                        ELSE json_value(agent, '$.browser_version')
                                    END)
              AND ('1'||(CASE session_length
                             WHEN session_length+1 THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) <> '0'||(CASE session_length
                                           WHEN session_length+1 THEN json_value(agent, '$.browser')
                                           ELSE json_value(agent, '$.browser_version')
                                       END)) IS TRUE
              AND ('1'||(CASE session_length
                             WHEN session_length+1 THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) = '0'||(CASE session_length
                                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)) IS NOT TRUE
              AND ('1'||(CASE session_length
                             WHEN session_length+1 THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) = '0'||(CASE session_length
                                          WHEN session_length+1 THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)) IS FALSE
              AND ('1'||(CASE session_length
                             WHEN session_length+1 THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) <> '0'||(CASE session_length
                                           WHEN session_length+1 THEN json_value(agent, '$.browser')
                                           ELSE json_value(agent, '$.browser_version')
                                       END)) IS NOT FALSE
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) BETWEEN '0'||(CASE session_length
                                               WHEN session_length+1 THEN json_value(agent, '$.browser')
                                               ELSE json_value(agent, '$.browser_version')
                                           END) AND 2||(CASE session_length
                                                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                            ELSE json_value(agent, '$.browser_version')
                                                        END)
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) NOT BETWEEN '1'||(CASE session_length
                                                   WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                   ELSE json_value(agent, '$.browser_version')
                                               END) AND '0'||(CASE session_length
                                                                  WHEN session_length+1 THEN json_value(agent, '$.browser')
                                                                  ELSE json_value(agent, '$.browser_version')
                                                              END)
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) like '%'
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) not like '__DOES_NOT_EXIST__%'
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) IN ('0'||(CASE session_length
                                           WHEN session_length+1 THEN json_value(agent, '$.browser')
                                           ELSE json_value(agent, '$.browser_version')
                                       END),
                                 1||(CASE session_length
                                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                                         ELSE json_value(agent, '$.browser_version')
                                     END),
                                 2||(CASE session_length
                                         WHEN session_length+1 THEN json_value(agent, '$.browser')
                                         ELSE json_value(agent, '$.browser_version')
                                     END))
              AND '1'||(CASE session_length
                            WHEN session_length+1 THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) NOT IN ('0'||(CASE session_length
                                               WHEN session_length+1 THEN json_value(agent, '$.browser')
                                               ELSE json_value(agent, '$.browser_version')
                                           END),
                                     2||(CASE session_length
                                             WHEN session_length+1 THEN json_value(agent, '$.browser')
                                             ELSE json_value(agent, '$.browser_version')
                                         END))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A3_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||cast(CASE
                     WHEN client_ip=server_ip THEN session_length
                     ELSE session_length+1
                 END AS char) IS NULL
       OR ('1'||cast(CASE
                         WHEN client_ip=server_ip THEN session_length
                         ELSE session_length+1
                     END AS char) = 1||cast(CASE
                                                WHEN client_ip=server_ip THEN session_length
                                                ELSE session_length+1
                                            END AS char)
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) IS NOT DISTINCT
           FROM 1||cast(CASE
                            WHEN client_ip=server_ip THEN session_length
                            ELSE session_length+1
                        END AS char)
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) <> '0'||cast(CASE
                                                       WHEN client_ip=server_ip THEN session_length
                                                       ELSE session_length+1
                                                   END AS char)
           AND ('1'||cast(CASE
                              WHEN client_ip=server_ip THEN session_length
                              ELSE session_length+1
                          END AS char) IS DISTINCT
                FROM '0'||cast(CASE
                                   WHEN client_ip=server_ip THEN session_length
                                   ELSE session_length+1
                               END AS char))
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) > '0'||cast(CASE
                                                      WHEN client_ip=server_ip THEN session_length
                                                      ELSE session_length+1
                                                  END AS char)
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) >= '0'||cast(CASE
                                                       WHEN client_ip=server_ip THEN session_length
                                                       ELSE session_length+1
                                                   END AS char)
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) < 2||cast(CASE
                                                    WHEN client_ip=server_ip THEN session_length
                                                    ELSE session_length+1
                                                END AS char)
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) <= 2||cast(CASE
                                                     WHEN client_ip=server_ip THEN session_length
                                                     ELSE session_length+1
                                                 END AS char)
           AND ('1'||cast(CASE
                              WHEN client_ip=server_ip THEN session_length
                              ELSE session_length+1
                          END AS char) <> '0'||cast(CASE
                                                        WHEN client_ip=server_ip THEN session_length
                                                        ELSE session_length+1
                                                    END AS char)) IS TRUE
           AND ('1'||cast(CASE
                              WHEN client_ip=server_ip THEN session_length
                              ELSE session_length+1
                          END AS char) = '0'||cast(CASE
                                                       WHEN client_ip=server_ip THEN session_length
                                                       ELSE session_length+1
                                                   END AS char)) IS NOT TRUE
           AND ('1'||cast(CASE
                              WHEN client_ip=server_ip THEN session_length
                              ELSE session_length+1
                          END AS char) = '0'||cast(CASE
                                                       WHEN client_ip=server_ip THEN session_length
                                                       ELSE session_length+1
                                                   END AS char)) IS FALSE
           AND ('1'||cast(CASE
                              WHEN client_ip=server_ip THEN session_length
                              ELSE session_length+1
                          END AS char) <> '0'||cast(CASE
                                                        WHEN client_ip=server_ip THEN session_length
                                                        ELSE session_length+1
                                                    END AS char)) IS NOT FALSE
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) BETWEEN '0'||cast(CASE
                                                            WHEN client_ip=server_ip THEN session_length
                                                            ELSE session_length+1
                                                        END AS char) AND 2||cast(CASE
                                                                                     WHEN client_ip=server_ip THEN session_length
                                                                                     ELSE session_length+1
                                                                                 END AS char)
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) NOT BETWEEN '1'||cast(CASE
                                                                WHEN client_ip=server_ip THEN session_length
                                                                ELSE session_length+1
                                                            END AS char) AND '0'||cast(CASE
                                                                                           WHEN client_ip=server_ip THEN session_length
                                                                                           ELSE session_length+1
                                                                                       END AS char)
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) like '%'
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) not like '__DOES_NOT_EXIST__%'
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) IN ('0'||cast(CASE
                                                        WHEN client_ip=server_ip THEN session_length
                                                        ELSE session_length+1
                                                    END AS char),
                                          1||cast(CASE
                                                      WHEN client_ip=server_ip THEN session_length
                                                      ELSE session_length+1
                                                  END AS char),
                                          2||cast(CASE
                                                      WHEN client_ip=server_ip THEN session_length
                                                      ELSE session_length+1
                                                  END AS char))
           AND '1'||cast(CASE
                             WHEN client_ip=server_ip THEN session_length
                             ELSE session_length+1
                         END AS char) NOT IN ('0'||cast(CASE
                                                            WHEN client_ip=server_ip THEN session_length
                                                            ELSE session_length+1
                                                        END AS char),
                                              2||cast(CASE
                                                          WHEN client_ip=server_ip THEN session_length
                                                          ELSE session_length+1
                                                      END AS char)))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A3_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||cast(CASE
                     WHEN client_ip=server_ip THEN session_length
                     ELSE session_length+1
                 END AS char) IS NULL
       OR '1'||cast(CASE
                        WHEN client_ip=server_ip THEN session_length
                        ELSE session_length+1
                    END AS char) IN
         (SELECT '1'||cast(CASE
                               WHEN client_ip=server_ip THEN session_length
                               ELSE session_length+1
                           END AS char)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||cast(CASE
                               WHEN client_ip=server_ip THEN session_length
                               ELSE session_length+1
                           END AS char) IS NULL
                 OR ('1'||cast(CASE
                                   WHEN client_ip=server_ip THEN session_length
                                   ELSE session_length+1
                               END AS char) = 1||cast(CASE
                                                          WHEN client_ip=server_ip THEN session_length
                                                          ELSE session_length+1
                                                      END AS char)
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) IS NOT DISTINCT
                     FROM 1||cast(CASE
                                      WHEN client_ip=server_ip THEN session_length
                                      ELSE session_length+1
                                  END AS char)
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) <> '0'||cast(CASE
                                                                 WHEN client_ip=server_ip THEN session_length
                                                                 ELSE session_length+1
                                                             END AS char)
                     AND ('1'||cast(CASE
                                        WHEN client_ip=server_ip THEN session_length
                                        ELSE session_length+1
                                    END AS char) IS DISTINCT
                          FROM '0'||cast(CASE
                                             WHEN client_ip=server_ip THEN session_length
                                             ELSE session_length+1
                                         END AS char))
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) > '0'||cast(CASE
                                                                WHEN client_ip=server_ip THEN session_length
                                                                ELSE session_length+1
                                                            END AS char)
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) >= '0'||cast(CASE
                                                                 WHEN client_ip=server_ip THEN session_length
                                                                 ELSE session_length+1
                                                             END AS char)
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) < 2||cast(CASE
                                                              WHEN client_ip=server_ip THEN session_length
                                                              ELSE session_length+1
                                                          END AS char)
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) <= 2||cast(CASE
                                                               WHEN client_ip=server_ip THEN session_length
                                                               ELSE session_length+1
                                                           END AS char)
                     AND ('1'||cast(CASE
                                        WHEN client_ip=server_ip THEN session_length
                                        ELSE session_length+1
                                    END AS char) <> '0'||cast(CASE
                                                                  WHEN client_ip=server_ip THEN session_length
                                                                  ELSE session_length+1
                                                              END AS char)) IS TRUE
                     AND ('1'||cast(CASE
                                        WHEN client_ip=server_ip THEN session_length
                                        ELSE session_length+1
                                    END AS char) = '0'||cast(CASE
                                                                 WHEN client_ip=server_ip THEN session_length
                                                                 ELSE session_length+1
                                                             END AS char)) IS NOT TRUE
                     AND ('1'||cast(CASE
                                        WHEN client_ip=server_ip THEN session_length
                                        ELSE session_length+1
                                    END AS char) = '0'||cast(CASE
                                                                 WHEN client_ip=server_ip THEN session_length
                                                                 ELSE session_length+1
                                                             END AS char)) IS FALSE
                     AND ('1'||cast(CASE
                                        WHEN client_ip=server_ip THEN session_length
                                        ELSE session_length+1
                                    END AS char) <> '0'||cast(CASE
                                                                  WHEN client_ip=server_ip THEN session_length
                                                                  ELSE session_length+1
                                                              END AS char)) IS NOT FALSE
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) BETWEEN '0'||cast(CASE
                                                                      WHEN client_ip=server_ip THEN session_length
                                                                      ELSE session_length+1
                                                                  END AS char) AND 2||cast(CASE
                                                                                               WHEN client_ip=server_ip THEN session_length
                                                                                               ELSE session_length+1
                                                                                           END AS char)
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) NOT BETWEEN '1'||cast(CASE
                                                                          WHEN client_ip=server_ip THEN session_length
                                                                          ELSE session_length+1
                                                                      END AS char) AND '0'||cast(CASE
                                                                                                     WHEN client_ip=server_ip THEN session_length
                                                                                                     ELSE session_length+1
                                                                                                 END AS char)
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) like '%'
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) not like '__DOES_NOT_EXIST__%'
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) IN ('0'||cast(CASE
                                                                  WHEN client_ip=server_ip THEN session_length
                                                                  ELSE session_length+1
                                                              END AS char),
                                                    1||cast(CASE
                                                                WHEN client_ip=server_ip THEN session_length
                                                                ELSE session_length+1
                                                            END AS char),
                                                    2||cast(CASE
                                                                WHEN client_ip=server_ip THEN session_length
                                                                ELSE session_length+1
                                                            END AS char))
                     AND '1'||cast(CASE
                                       WHEN client_ip=server_ip THEN session_length
                                       ELSE session_length+1
                                   END AS char) NOT IN ('0'||cast(CASE
                                                                      WHEN client_ip=server_ip THEN session_length
                                                                      ELSE session_length+1
                                                                  END AS char),
                                                        2||cast(CASE
                                                                    WHEN client_ip=server_ip THEN session_length
                                                                    ELSE session_length+1
                                                                END AS char))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A3_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||cast(CASE
                                        WHEN client_ip=server_ip THEN session_length
                                        ELSE session_length+1
                                    END AS char),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||cast(CASE
                        WHEN client_ip=server_ip THEN session_length
                        ELSE session_length+1
                    END AS char) IS NULL
          OR ('1'||cast(CASE
                            WHEN client_ip=server_ip THEN session_length
                            ELSE session_length+1
                        END AS char) = 1||cast(CASE
                                                   WHEN client_ip=server_ip THEN session_length
                                                   ELSE session_length+1
                                               END AS char)
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) IS NOT DISTINCT
              FROM 1||cast(CASE
                               WHEN client_ip=server_ip THEN session_length
                               ELSE session_length+1
                           END AS char)
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) <> '0'||cast(CASE
                                                          WHEN client_ip=server_ip THEN session_length
                                                          ELSE session_length+1
                                                      END AS char)
              AND ('1'||cast(CASE
                                 WHEN client_ip=server_ip THEN session_length
                                 ELSE session_length+1
                             END AS char) IS DISTINCT
                   FROM '0'||cast(CASE
                                      WHEN client_ip=server_ip THEN session_length
                                      ELSE session_length+1
                                  END AS char))
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) > '0'||cast(CASE
                                                         WHEN client_ip=server_ip THEN session_length
                                                         ELSE session_length+1
                                                     END AS char)
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) >= '0'||cast(CASE
                                                          WHEN client_ip=server_ip THEN session_length
                                                          ELSE session_length+1
                                                      END AS char)
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) < 2||cast(CASE
                                                       WHEN client_ip=server_ip THEN session_length
                                                       ELSE session_length+1
                                                   END AS char)
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) <= 2||cast(CASE
                                                        WHEN client_ip=server_ip THEN session_length
                                                        ELSE session_length+1
                                                    END AS char)
              AND ('1'||cast(CASE
                                 WHEN client_ip=server_ip THEN session_length
                                 ELSE session_length+1
                             END AS char) <> '0'||cast(CASE
                                                           WHEN client_ip=server_ip THEN session_length
                                                           ELSE session_length+1
                                                       END AS char)) IS TRUE
              AND ('1'||cast(CASE
                                 WHEN client_ip=server_ip THEN session_length
                                 ELSE session_length+1
                             END AS char) = '0'||cast(CASE
                                                          WHEN client_ip=server_ip THEN session_length
                                                          ELSE session_length+1
                                                      END AS char)) IS NOT TRUE
              AND ('1'||cast(CASE
                                 WHEN client_ip=server_ip THEN session_length
                                 ELSE session_length+1
                             END AS char) = '0'||cast(CASE
                                                          WHEN client_ip=server_ip THEN session_length
                                                          ELSE session_length+1
                                                      END AS char)) IS FALSE
              AND ('1'||cast(CASE
                                 WHEN client_ip=server_ip THEN session_length
                                 ELSE session_length+1
                             END AS char) <> '0'||cast(CASE
                                                           WHEN client_ip=server_ip THEN session_length
                                                           ELSE session_length+1
                                                       END AS char)) IS NOT FALSE
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) BETWEEN '0'||cast(CASE
                                                               WHEN client_ip=server_ip THEN session_length
                                                               ELSE session_length+1
                                                           END AS char) AND 2||cast(CASE
                                                                                        WHEN client_ip=server_ip THEN session_length
                                                                                        ELSE session_length+1
                                                                                    END AS char)
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) NOT BETWEEN '1'||cast(CASE
                                                                   WHEN client_ip=server_ip THEN session_length
                                                                   ELSE session_length+1
                                                               END AS char) AND '0'||cast(CASE
                                                                                              WHEN client_ip=server_ip THEN session_length
                                                                                              ELSE session_length+1
                                                                                          END AS char)
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) like '%'
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) not like '__DOES_NOT_EXIST__%'
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) IN ('0'||cast(CASE
                                                           WHEN client_ip=server_ip THEN session_length
                                                           ELSE session_length+1
                                                       END AS char),
                                             1||cast(CASE
                                                         WHEN client_ip=server_ip THEN session_length
                                                         ELSE session_length+1
                                                     END AS char),
                                             2||cast(CASE
                                                         WHEN client_ip=server_ip THEN session_length
                                                         ELSE session_length+1
                                                     END AS char))
              AND '1'||cast(CASE
                                WHEN client_ip=server_ip THEN session_length
                                ELSE session_length+1
                            END AS char) NOT IN ('0'||cast(CASE
                                                               WHEN client_ip=server_ip THEN session_length
                                                               ELSE session_length+1
                                                           END AS char),
                                                 2||cast(CASE
                                                             WHEN client_ip=server_ip THEN session_length
                                                             ELSE session_length+1
                                                         END AS char))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A4_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||(CASE
                 WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                 ELSE json_value(agent, '$.browser_version')
             END) IS NULL
       OR ('1'||(CASE
                     WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                     ELSE json_value(agent, '$.browser_version')
                 END) = 1||(CASE
                                WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                ELSE json_value(agent, '$.browser_version')
                            END)
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) IS NOT DISTINCT
           FROM 1||(CASE
                        WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                        ELSE json_value(agent, '$.browser_version')
                    END)
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) <> '0'||(CASE
                                       WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)
           AND ('1'||(CASE
                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) IS DISTINCT
                FROM '0'||(CASE
                               WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                               ELSE json_value(agent, '$.browser_version')
                           END))
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) > '0'||(CASE
                                      WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                      ELSE json_value(agent, '$.browser_version')
                                  END)
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) >= '0'||(CASE
                                       WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) < 2||(CASE
                                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END)
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) <= 2||(CASE
                                     WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                     ELSE json_value(agent, '$.browser_version')
                                 END)
           AND ('1'||(CASE
                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) <> '0'||(CASE
                                        WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                        ELSE json_value(agent, '$.browser_version')
                                    END)) IS TRUE
           AND ('1'||(CASE
                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) = '0'||(CASE
                                       WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)) IS NOT TRUE
           AND ('1'||(CASE
                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) = '0'||(CASE
                                       WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)) IS FALSE
           AND ('1'||(CASE
                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                          ELSE json_value(agent, '$.browser_version')
                      END) <> '0'||(CASE
                                        WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                        ELSE json_value(agent, '$.browser_version')
                                    END)) IS NOT FALSE
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) BETWEEN '0'||(CASE
                                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                            ELSE json_value(agent, '$.browser_version')
                                        END) AND 2||(CASE
                                                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                         ELSE json_value(agent, '$.browser_version')
                                                     END)
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) NOT BETWEEN '1'||(CASE
                                                WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                ELSE json_value(agent, '$.browser_version')
                                            END) AND '0'||(CASE
                                                               WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                               ELSE json_value(agent, '$.browser_version')
                                                           END)
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) like '%'
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) not like '__DOES_NOT_EXIST__%'
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) IN ('0'||(CASE
                                        WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                        ELSE json_value(agent, '$.browser_version')
                                    END),
                              1||(CASE
                                      WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                      ELSE json_value(agent, '$.browser_version')
                                  END),
                              2||(CASE
                                      WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                      ELSE json_value(agent, '$.browser_version')
                                  END))
           AND '1'||(CASE
                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                         ELSE json_value(agent, '$.browser_version')
                     END) NOT IN ('0'||(CASE
                                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                            ELSE json_value(agent, '$.browser_version')
                                        END),
                                  2||(CASE
                                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A4_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||(CASE
                 WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                 ELSE json_value(agent, '$.browser_version')
             END) IS NULL
       OR '1'||(CASE
                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                    ELSE json_value(agent, '$.browser_version')
                END) IN
         (SELECT '1'||(CASE
                           WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                           ELSE json_value(agent, '$.browser_version')
                       END)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||(CASE
                           WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                           ELSE json_value(agent, '$.browser_version')
                       END) IS NULL
                 OR ('1'||(CASE
                               WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                               ELSE json_value(agent, '$.browser_version')
                           END) = 1||(CASE
                                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) IS NOT DISTINCT
                     FROM 1||(CASE
                                  WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                  ELSE json_value(agent, '$.browser_version')
                              END)
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) <> '0'||(CASE
                                                 WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                 ELSE json_value(agent, '$.browser_version')
                                             END)
                     AND ('1'||(CASE
                                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) IS DISTINCT
                          FROM '0'||(CASE
                                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                         ELSE json_value(agent, '$.browser_version')
                                     END))
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) > '0'||(CASE
                                                WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                ELSE json_value(agent, '$.browser_version')
                                            END)
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) >= '0'||(CASE
                                                 WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                 ELSE json_value(agent, '$.browser_version')
                                             END)
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) < 2||(CASE
                                              WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                              ELSE json_value(agent, '$.browser_version')
                                          END)
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) <= 2||(CASE
                                               WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                               ELSE json_value(agent, '$.browser_version')
                                           END)
                     AND ('1'||(CASE
                                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) <> '0'||(CASE
                                                  WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                  ELSE json_value(agent, '$.browser_version')
                                              END)) IS TRUE
                     AND ('1'||(CASE
                                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) = '0'||(CASE
                                                 WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                 ELSE json_value(agent, '$.browser_version')
                                             END)) IS NOT TRUE
                     AND ('1'||(CASE
                                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) = '0'||(CASE
                                                 WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                 ELSE json_value(agent, '$.browser_version')
                                             END)) IS FALSE
                     AND ('1'||(CASE
                                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END) <> '0'||(CASE
                                                  WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                  ELSE json_value(agent, '$.browser_version')
                                              END)) IS NOT FALSE
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) BETWEEN '0'||(CASE
                                                      WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                      ELSE json_value(agent, '$.browser_version')
                                                  END) AND 2||(CASE
                                                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                                   ELSE json_value(agent, '$.browser_version')
                                                               END)
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) NOT BETWEEN '1'||(CASE
                                                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                          ELSE json_value(agent, '$.browser_version')
                                                      END) AND '0'||(CASE
                                                                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                                         ELSE json_value(agent, '$.browser_version')
                                                                     END)
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) like '%'
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) not like '__DOES_NOT_EXIST__%'
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) IN ('0'||(CASE
                                                  WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                  ELSE json_value(agent, '$.browser_version')
                                              END),
                                        1||(CASE
                                                WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                ELSE json_value(agent, '$.browser_version')
                                            END),
                                        2||(CASE
                                                WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                ELSE json_value(agent, '$.browser_version')
                                            END))
                     AND '1'||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END) NOT IN ('0'||(CASE
                                                      WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                      ELSE json_value(agent, '$.browser_version')
                                                  END),
                                            2||(CASE
                                                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                    ELSE json_value(agent, '$.browser_version')
                                                END))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A4_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||(CASE
                                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                    ELSE json_value(agent, '$.browser_version')
                                END),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||(CASE
                    WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                    ELSE json_value(agent, '$.browser_version')
                END) IS NULL
          OR ('1'||(CASE
                        WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                        ELSE json_value(agent, '$.browser_version')
                    END) = 1||(CASE
                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                   ELSE json_value(agent, '$.browser_version')
                               END)
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) IS NOT DISTINCT
              FROM 1||(CASE
                           WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                           ELSE json_value(agent, '$.browser_version')
                       END)
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) <> '0'||(CASE
                                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)
              AND ('1'||(CASE
                             WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) IS DISTINCT
                   FROM '0'||(CASE
                                  WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                  ELSE json_value(agent, '$.browser_version')
                              END))
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) > '0'||(CASE
                                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                         ELSE json_value(agent, '$.browser_version')
                                     END)
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) >= '0'||(CASE
                                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) < 2||(CASE
                                       WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                       ELSE json_value(agent, '$.browser_version')
                                   END)
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) <= 2||(CASE
                                        WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                        ELSE json_value(agent, '$.browser_version')
                                    END)
              AND ('1'||(CASE
                             WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) <> '0'||(CASE
                                           WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                           ELSE json_value(agent, '$.browser_version')
                                       END)) IS TRUE
              AND ('1'||(CASE
                             WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) = '0'||(CASE
                                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)) IS NOT TRUE
              AND ('1'||(CASE
                             WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) = '0'||(CASE
                                          WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                          ELSE json_value(agent, '$.browser_version')
                                      END)) IS FALSE
              AND ('1'||(CASE
                             WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                             ELSE json_value(agent, '$.browser_version')
                         END) <> '0'||(CASE
                                           WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                           ELSE json_value(agent, '$.browser_version')
                                       END)) IS NOT FALSE
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) BETWEEN '0'||(CASE
                                               WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                               ELSE json_value(agent, '$.browser_version')
                                           END) AND 2||(CASE
                                                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                            ELSE json_value(agent, '$.browser_version')
                                                        END)
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) NOT BETWEEN '1'||(CASE
                                                   WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                   ELSE json_value(agent, '$.browser_version')
                                               END) AND '0'||(CASE
                                                                  WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                                                  ELSE json_value(agent, '$.browser_version')
                                                              END)
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) like '%'
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) not like '__DOES_NOT_EXIST__%'
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) IN ('0'||(CASE
                                           WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                           ELSE json_value(agent, '$.browser_version')
                                       END),
                                 1||(CASE
                                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                         ELSE json_value(agent, '$.browser_version')
                                     END),
                                 2||(CASE
                                         WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                         ELSE json_value(agent, '$.browser_version')
                                     END))
              AND '1'||(CASE
                            WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                            ELSE json_value(agent, '$.browser_version')
                        END) NOT IN ('0'||(CASE
                                               WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                               ELSE json_value(agent, '$.browser_version')
                                           END),
                                     2||(CASE
                                             WHEN json_value(agent, '$.browser')=json_value(agent, '$.browser_version') THEN json_value(agent, '$.browser')
                                             ELSE json_value(agent, '$.browser_version')
                                         END))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A5_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||cast(session_length AS char) IS NULL
       OR ('1'||cast(session_length AS char) = 1||cast(session_length AS char)
           AND '1'||cast(session_length AS char) IS NOT DISTINCT
           FROM 1||cast(session_length AS char)
           AND '1'||cast(session_length AS char) <> '0'||cast(session_length AS char)
           AND ('1'||cast(session_length AS char) IS DISTINCT
                FROM '0'||cast(session_length AS char))
           AND '1'||cast(session_length AS char) > '0'||cast(session_length AS char)
           AND '1'||cast(session_length AS char) >= '0'||cast(session_length AS char)
           AND '1'||cast(session_length AS char) < 2||cast(session_length AS char)
           AND '1'||cast(session_length AS char) <= 2||cast(session_length AS char)
           AND ('1'||cast(session_length AS char) <> '0'||cast(session_length AS char)) IS TRUE
           AND ('1'||cast(session_length AS char) = '0'||cast(session_length AS char)) IS NOT TRUE
           AND ('1'||cast(session_length AS char) = '0'||cast(session_length AS char)) IS FALSE
           AND ('1'||cast(session_length AS char) <> '0'||cast(session_length AS char)) IS NOT FALSE
           AND '1'||cast(session_length AS char) BETWEEN '0'||cast(session_length AS char) AND 2||cast(session_length AS char)
           AND '1'||cast(session_length AS char) NOT BETWEEN '1'||cast(session_length AS char) AND '0'||cast(session_length AS char)
           AND '1'||cast(session_length AS char) like '%'
           AND '1'||cast(session_length AS char) not like '__DOES_NOT_EXIST__%'
           AND '1'||cast(session_length AS char) IN ('0'||cast(session_length AS char),
                                                     1||cast(session_length AS char),
                                                     2||cast(session_length AS char))
           AND '1'||cast(session_length AS char) NOT IN ('0'||cast(session_length AS char),
                                                         2||cast(session_length AS char)))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A5_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||cast(session_length AS char) IS NULL
       OR '1'||cast(session_length AS char) IN
         (SELECT '1'||cast(session_length AS char)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||cast(session_length AS char) IS NULL
                 OR ('1'||cast(session_length AS char) = 1||cast(session_length AS char)
                     AND '1'||cast(session_length AS char) IS NOT DISTINCT
                     FROM 1||cast(session_length AS char)
                     AND '1'||cast(session_length AS char) <> '0'||cast(session_length AS char)
                     AND ('1'||cast(session_length AS char) IS DISTINCT
                          FROM '0'||cast(session_length AS char))
                     AND '1'||cast(session_length AS char) > '0'||cast(session_length AS char)
                     AND '1'||cast(session_length AS char) >= '0'||cast(session_length AS char)
                     AND '1'||cast(session_length AS char) < 2||cast(session_length AS char)
                     AND '1'||cast(session_length AS char) <= 2||cast(session_length AS char)
                     AND ('1'||cast(session_length AS char) <> '0'||cast(session_length AS char)) IS TRUE
                     AND ('1'||cast(session_length AS char) = '0'||cast(session_length AS char)) IS NOT TRUE
                     AND ('1'||cast(session_length AS char) = '0'||cast(session_length AS char)) IS FALSE
                     AND ('1'||cast(session_length AS char) <> '0'||cast(session_length AS char)) IS NOT FALSE
                     AND '1'||cast(session_length AS char) BETWEEN '0'||cast(session_length AS char) AND 2||cast(session_length AS char)
                     AND '1'||cast(session_length AS char) NOT BETWEEN '1'||cast(session_length AS char) AND '0'||cast(session_length AS char)
                     AND '1'||cast(session_length AS char) like '%'
                     AND '1'||cast(session_length AS char) not like '__DOES_NOT_EXIST__%'
                     AND '1'||cast(session_length AS char) IN ('0'||cast(session_length AS char),
                                                               1||cast(session_length AS char),
                                                               2||cast(session_length AS char))
                     AND '1'||cast(session_length AS char) NOT IN ('0'||cast(session_length AS char),
                                                                   2||cast(session_length AS char))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A5_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||cast(session_length AS char),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||cast(session_length AS char) IS NULL
          OR ('1'||cast(session_length AS char) = 1||cast(session_length AS char)
              AND '1'||cast(session_length AS char) IS NOT DISTINCT
              FROM 1||cast(session_length AS char)
              AND '1'||cast(session_length AS char) <> '0'||cast(session_length AS char)
              AND ('1'||cast(session_length AS char) IS DISTINCT
                   FROM '0'||cast(session_length AS char))
              AND '1'||cast(session_length AS char) > '0'||cast(session_length AS char)
              AND '1'||cast(session_length AS char) >= '0'||cast(session_length AS char)
              AND '1'||cast(session_length AS char) < 2||cast(session_length AS char)
              AND '1'||cast(session_length AS char) <= 2||cast(session_length AS char)
              AND ('1'||cast(session_length AS char) <> '0'||cast(session_length AS char)) IS TRUE
              AND ('1'||cast(session_length AS char) = '0'||cast(session_length AS char)) IS NOT TRUE
              AND ('1'||cast(session_length AS char) = '0'||cast(session_length AS char)) IS FALSE
              AND ('1'||cast(session_length AS char) <> '0'||cast(session_length AS char)) IS NOT FALSE
              AND '1'||cast(session_length AS char) BETWEEN '0'||cast(session_length AS char) AND 2||cast(session_length AS char)
              AND '1'||cast(session_length AS char) NOT BETWEEN '1'||cast(session_length AS char) AND '0'||cast(session_length AS char)
              AND '1'||cast(session_length AS char) like '%'
              AND '1'||cast(session_length AS char) not like '__DOES_NOT_EXIST__%'
              AND '1'||cast(session_length AS char) IN ('0'||cast(session_length AS char),
                                                        1||cast(session_length AS char),
                                                        2||cast(session_length AS char))
              AND '1'||cast(session_length AS char) NOT IN ('0'||cast(session_length AS char),
                                                            2||cast(session_length AS char))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A6_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND (cast(ltrim("session", 'S') AS bigint)+1 IS NULL
       OR (cast(ltrim("session", 'S') AS bigint)+1 = cast(ltrim("session", 'S') AS bigint)+1
           AND cast(ltrim("session", 'S') AS bigint)+1 IS NOT DISTINCT
           FROM cast(ltrim("session", 'S') AS bigint)+1
           AND cast(ltrim("session", 'S') AS bigint)+1 <> cast(ltrim("session", 'S') AS bigint)
           AND (cast(ltrim("session", 'S') AS bigint)+1 IS DISTINCT
                FROM cast(ltrim("session", 'S') AS bigint))
           AND cast(ltrim("session", 'S') AS bigint)+1 > cast(ltrim("session", 'S') AS bigint)
           AND cast(ltrim("session", 'S') AS bigint)+1 >= cast(ltrim("session", 'S') AS bigint)
           AND cast(ltrim("session", 'S') AS bigint)+1 < cast(ltrim("session", 'S') AS bigint)+2
           AND cast(ltrim("session", 'S') AS bigint)+1 <= cast(ltrim("session", 'S') AS bigint)+2
           AND (cast(ltrim("session", 'S') AS bigint)+1 <> cast(ltrim("session", 'S') AS bigint)) IS TRUE
           AND (cast(ltrim("session", 'S') AS bigint)+1 = cast(ltrim("session", 'S') AS bigint)) IS NOT TRUE
           AND (cast(ltrim("session", 'S') AS bigint)+1 = cast(ltrim("session", 'S') AS bigint)) IS FALSE
           AND (cast(ltrim("session", 'S') AS bigint)+1 <> cast(ltrim("session", 'S') AS bigint)) IS NOT FALSE
           AND cast(ltrim("session", 'S') AS bigint)+1 BETWEEN cast(ltrim("session", 'S') AS bigint) AND cast(ltrim("session", 'S') AS bigint)+2
           AND cast(ltrim("session", 'S') AS bigint)+1 NOT BETWEEN cast(ltrim("session", 'S') AS bigint)+1 AND cast(ltrim("session", 'S') AS bigint)
           AND cast(ltrim("session", 'S') AS bigint)+1 like '%'
           AND cast(ltrim("session", 'S') AS bigint)+1 not like '__DOES_NOT_EXIST__%'
           AND cast(ltrim("session", 'S') AS bigint)+1 IN (cast(ltrim("session", 'S') AS bigint),
                                                           cast(ltrim("session", 'S') AS bigint)+1,
                                                           cast(ltrim("session", 'S') AS bigint)+2)
           AND cast(ltrim("session", 'S') AS bigint)+1 NOT IN (cast(ltrim("session", 'S') AS bigint),
                                                               cast(ltrim("session", 'S') AS bigint)+2))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A6_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND (cast(ltrim("session", 'S') AS bigint)+1 IS NULL
       OR cast(ltrim("session", 'S') AS bigint)+1 IN
         (SELECT cast(ltrim("session", 'S') AS bigint)+1
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND (cast(ltrim("session", 'S') AS bigint)+1 IS NULL
                 OR (cast(ltrim("session", 'S') AS bigint)+1 = cast(ltrim("session", 'S') AS bigint)+1
                     AND cast(ltrim("session", 'S') AS bigint)+1 IS NOT DISTINCT
                     FROM cast(ltrim("session", 'S') AS bigint)+1
                     AND cast(ltrim("session", 'S') AS bigint)+1 <> cast(ltrim("session", 'S') AS bigint)
                     AND (cast(ltrim("session", 'S') AS bigint)+1 IS DISTINCT
                          FROM cast(ltrim("session", 'S') AS bigint))
                     AND cast(ltrim("session", 'S') AS bigint)+1 > cast(ltrim("session", 'S') AS bigint)
                     AND cast(ltrim("session", 'S') AS bigint)+1 >= cast(ltrim("session", 'S') AS bigint)
                     AND cast(ltrim("session", 'S') AS bigint)+1 < cast(ltrim("session", 'S') AS bigint)+2
                     AND cast(ltrim("session", 'S') AS bigint)+1 <= cast(ltrim("session", 'S') AS bigint)+2
                     AND (cast(ltrim("session", 'S') AS bigint)+1 <> cast(ltrim("session", 'S') AS bigint)) IS TRUE
                     AND (cast(ltrim("session", 'S') AS bigint)+1 = cast(ltrim("session", 'S') AS bigint)) IS NOT TRUE
                     AND (cast(ltrim("session", 'S') AS bigint)+1 = cast(ltrim("session", 'S') AS bigint)) IS FALSE
                     AND (cast(ltrim("session", 'S') AS bigint)+1 <> cast(ltrim("session", 'S') AS bigint)) IS NOT FALSE
                     AND cast(ltrim("session", 'S') AS bigint)+1 BETWEEN cast(ltrim("session", 'S') AS bigint) AND cast(ltrim("session", 'S') AS bigint)+2
                     AND cast(ltrim("session", 'S') AS bigint)+1 NOT BETWEEN cast(ltrim("session", 'S') AS bigint)+1 AND cast(ltrim("session", 'S') AS bigint)
                     AND cast(ltrim("session", 'S') AS bigint)+1 like '%'
                     AND cast(ltrim("session", 'S') AS bigint)+1 not like '__DOES_NOT_EXIST__%'
                     AND cast(ltrim("session", 'S') AS bigint)+1 IN (cast(ltrim("session", 'S') AS bigint),
                                                                     cast(ltrim("session", 'S') AS bigint)+1,
                                                                     cast(ltrim("session", 'S') AS bigint)+2)
                     AND cast(ltrim("session", 'S') AS bigint)+1 NOT IN (cast(ltrim("session", 'S') AS bigint),
                                                                         cast(ltrim("session", 'S') AS bigint)+2)))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A6_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          cast(ltrim("session", 'S') AS bigint)+1,
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND (cast(ltrim("session", 'S') AS bigint)+1 IS NULL
          OR (cast(ltrim("session", 'S') AS bigint)+1 = cast(ltrim("session", 'S') AS bigint)+1
              AND cast(ltrim("session", 'S') AS bigint)+1 IS NOT DISTINCT
              FROM cast(ltrim("session", 'S') AS bigint)+1
              AND cast(ltrim("session", 'S') AS bigint)+1 <> cast(ltrim("session", 'S') AS bigint)
              AND (cast(ltrim("session", 'S') AS bigint)+1 IS DISTINCT
                   FROM cast(ltrim("session", 'S') AS bigint))
              AND cast(ltrim("session", 'S') AS bigint)+1 > cast(ltrim("session", 'S') AS bigint)
              AND cast(ltrim("session", 'S') AS bigint)+1 >= cast(ltrim("session", 'S') AS bigint)
              AND cast(ltrim("session", 'S') AS bigint)+1 < cast(ltrim("session", 'S') AS bigint)+2
              AND cast(ltrim("session", 'S') AS bigint)+1 <= cast(ltrim("session", 'S') AS bigint)+2
              AND (cast(ltrim("session", 'S') AS bigint)+1 <> cast(ltrim("session", 'S') AS bigint)) IS TRUE
              AND (cast(ltrim("session", 'S') AS bigint)+1 = cast(ltrim("session", 'S') AS bigint)) IS NOT TRUE
              AND (cast(ltrim("session", 'S') AS bigint)+1 = cast(ltrim("session", 'S') AS bigint)) IS FALSE
              AND (cast(ltrim("session", 'S') AS bigint)+1 <> cast(ltrim("session", 'S') AS bigint)) IS NOT FALSE
              AND cast(ltrim("session", 'S') AS bigint)+1 BETWEEN cast(ltrim("session", 'S') AS bigint) AND cast(ltrim("session", 'S') AS bigint)+2
              AND cast(ltrim("session", 'S') AS bigint)+1 NOT BETWEEN cast(ltrim("session", 'S') AS bigint)+1 AND cast(ltrim("session", 'S') AS bigint)
              AND cast(ltrim("session", 'S') AS bigint)+1 like '%'
              AND cast(ltrim("session", 'S') AS bigint)+1 not like '__DOES_NOT_EXIST__%'
              AND cast(ltrim("session", 'S') AS bigint)+1 IN (cast(ltrim("session", 'S') AS bigint),
                                                              cast(ltrim("session", 'S') AS bigint)+1,
                                                              cast(ltrim("session", 'S') AS bigint)+2)
              AND cast(ltrim("session", 'S') AS bigint)+1 NOT IN (cast(ltrim("session", 'S') AS bigint),
                                                                  cast(ltrim("session", 'S') AS bigint)+2)))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A7_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND (floor(cast(ltrim("session", 'S') AS float))+1 IS NULL
       OR (floor(cast(ltrim("session", 'S') AS float))+1 = floor(cast(ltrim("session", 'S') AS float))+1
           AND floor(cast(ltrim("session", 'S') AS float))+1 IS NOT DISTINCT
           FROM floor(cast(ltrim("session", 'S') AS float))+1
           AND floor(cast(ltrim("session", 'S') AS float))+1 <> floor(cast(ltrim("session", 'S') AS float))
           AND (floor(cast(ltrim("session", 'S') AS float))+1 IS DISTINCT
                FROM floor(cast(ltrim("session", 'S') AS float)))
           AND floor(cast(ltrim("session", 'S') AS float))+1 > floor(cast(ltrim("session", 'S') AS float))
           AND floor(cast(ltrim("session", 'S') AS float))+1 >= floor(cast(ltrim("session", 'S') AS float))
           AND floor(cast(ltrim("session", 'S') AS float))+1 < floor(cast(ltrim("session", 'S') AS float))+2
           AND floor(cast(ltrim("session", 'S') AS float))+1 <= floor(cast(ltrim("session", 'S') AS float))+2
           AND (floor(cast(ltrim("session", 'S') AS float))+1 <> floor(cast(ltrim("session", 'S') AS float))) IS TRUE
           AND (floor(cast(ltrim("session", 'S') AS float))+1 = floor(cast(ltrim("session", 'S') AS float))) IS NOT TRUE
           AND (floor(cast(ltrim("session", 'S') AS float))+1 = floor(cast(ltrim("session", 'S') AS float))) IS FALSE
           AND (floor(cast(ltrim("session", 'S') AS float))+1 <> floor(cast(ltrim("session", 'S') AS float))) IS NOT FALSE
           AND floor(cast(ltrim("session", 'S') AS float))+1 BETWEEN floor(cast(ltrim("session", 'S') AS float)) AND floor(cast(ltrim("session", 'S') AS float))+2
           AND floor(cast(ltrim("session", 'S') AS float))+1 NOT BETWEEN floor(cast(ltrim("session", 'S') AS float))+1 AND floor(cast(ltrim("session", 'S') AS float))
           AND floor(cast(ltrim("session", 'S') AS float))+1 like '%'
           AND floor(cast(ltrim("session", 'S') AS float))+1 not like '__DOES_NOT_EXIST__%'
           AND floor(cast(ltrim("session", 'S') AS float))+1 IN (floor(cast(ltrim("session", 'S') AS float)),
                                                                 floor(cast(ltrim("session", 'S') AS float))+1,
                                                                 floor(cast(ltrim("session", 'S') AS float))+2)
           AND floor(cast(ltrim("session", 'S') AS float))+1 NOT IN (floor(cast(ltrim("session", 'S') AS float)),
                                                                     floor(cast(ltrim("session", 'S') AS float))+2))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A7_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND (floor(cast(ltrim("session", 'S') AS float))+1 IS NULL
       OR floor(cast(ltrim("session", 'S') AS float))+1 IN
         (SELECT floor(cast(ltrim("session", 'S') AS float))+1
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND (floor(cast(ltrim("session", 'S') AS float))+1 IS NULL
                 OR (floor(cast(ltrim("session", 'S') AS float))+1 = floor(cast(ltrim("session", 'S') AS float))+1
                     AND floor(cast(ltrim("session", 'S') AS float))+1 IS NOT DISTINCT
                     FROM floor(cast(ltrim("session", 'S') AS float))+1
                     AND floor(cast(ltrim("session", 'S') AS float))+1 <> floor(cast(ltrim("session", 'S') AS float))
                     AND (floor(cast(ltrim("session", 'S') AS float))+1 IS DISTINCT
                          FROM floor(cast(ltrim("session", 'S') AS float)))
                     AND floor(cast(ltrim("session", 'S') AS float))+1 > floor(cast(ltrim("session", 'S') AS float))
                     AND floor(cast(ltrim("session", 'S') AS float))+1 >= floor(cast(ltrim("session", 'S') AS float))
                     AND floor(cast(ltrim("session", 'S') AS float))+1 < floor(cast(ltrim("session", 'S') AS float))+2
                     AND floor(cast(ltrim("session", 'S') AS float))+1 <= floor(cast(ltrim("session", 'S') AS float))+2
                     AND (floor(cast(ltrim("session", 'S') AS float))+1 <> floor(cast(ltrim("session", 'S') AS float))) IS TRUE
                     AND (floor(cast(ltrim("session", 'S') AS float))+1 = floor(cast(ltrim("session", 'S') AS float))) IS NOT TRUE
                     AND (floor(cast(ltrim("session", 'S') AS float))+1 = floor(cast(ltrim("session", 'S') AS float))) IS FALSE
                     AND (floor(cast(ltrim("session", 'S') AS float))+1 <> floor(cast(ltrim("session", 'S') AS float))) IS NOT FALSE
                     AND floor(cast(ltrim("session", 'S') AS float))+1 BETWEEN floor(cast(ltrim("session", 'S') AS float)) AND floor(cast(ltrim("session", 'S') AS float))+2
                     AND floor(cast(ltrim("session", 'S') AS float))+1 NOT BETWEEN floor(cast(ltrim("session", 'S') AS float))+1 AND floor(cast(ltrim("session", 'S') AS float))
                     AND floor(cast(ltrim("session", 'S') AS float))+1 like '%'
                     AND floor(cast(ltrim("session", 'S') AS float))+1 not like '__DOES_NOT_EXIST__%'
                     AND floor(cast(ltrim("session", 'S') AS float))+1 IN (floor(cast(ltrim("session", 'S') AS float)),
                                                                           floor(cast(ltrim("session", 'S') AS float))+1,
                                                                           floor(cast(ltrim("session", 'S') AS float))+2)
                     AND floor(cast(ltrim("session", 'S') AS float))+1 NOT IN (floor(cast(ltrim("session", 'S') AS float)),
                                                                               floor(cast(ltrim("session", 'S') AS float))+2)))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A7_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          floor(cast(ltrim("session", 'S') AS float))+1,
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND (floor(cast(ltrim("session", 'S') AS float))+1 IS NULL
          OR (floor(cast(ltrim("session", 'S') AS float))+1 = floor(cast(ltrim("session", 'S') AS float))+1
              AND floor(cast(ltrim("session", 'S') AS float))+1 IS NOT DISTINCT
              FROM floor(cast(ltrim("session", 'S') AS float))+1
              AND floor(cast(ltrim("session", 'S') AS float))+1 <> floor(cast(ltrim("session", 'S') AS float))
              AND (floor(cast(ltrim("session", 'S') AS float))+1 IS DISTINCT
                   FROM floor(cast(ltrim("session", 'S') AS float)))
              AND floor(cast(ltrim("session", 'S') AS float))+1 > floor(cast(ltrim("session", 'S') AS float))
              AND floor(cast(ltrim("session", 'S') AS float))+1 >= floor(cast(ltrim("session", 'S') AS float))
              AND floor(cast(ltrim("session", 'S') AS float))+1 < floor(cast(ltrim("session", 'S') AS float))+2
              AND floor(cast(ltrim("session", 'S') AS float))+1 <= floor(cast(ltrim("session", 'S') AS float))+2
              AND (floor(cast(ltrim("session", 'S') AS float))+1 <> floor(cast(ltrim("session", 'S') AS float))) IS TRUE
              AND (floor(cast(ltrim("session", 'S') AS float))+1 = floor(cast(ltrim("session", 'S') AS float))) IS NOT TRUE
              AND (floor(cast(ltrim("session", 'S') AS float))+1 = floor(cast(ltrim("session", 'S') AS float))) IS FALSE
              AND (floor(cast(ltrim("session", 'S') AS float))+1 <> floor(cast(ltrim("session", 'S') AS float))) IS NOT FALSE
              AND floor(cast(ltrim("session", 'S') AS float))+1 BETWEEN floor(cast(ltrim("session", 'S') AS float)) AND floor(cast(ltrim("session", 'S') AS float))+2
              AND floor(cast(ltrim("session", 'S') AS float))+1 NOT BETWEEN floor(cast(ltrim("session", 'S') AS float))+1 AND floor(cast(ltrim("session", 'S') AS float))
              AND floor(cast(ltrim("session", 'S') AS float))+1 like '%'
              AND floor(cast(ltrim("session", 'S') AS float))+1 not like '__DOES_NOT_EXIST__%'
              AND floor(cast(ltrim("session", 'S') AS float))+1 IN (floor(cast(ltrim("session", 'S') AS float)),
                                                                    floor(cast(ltrim("session", 'S') AS float))+1,
                                                                    floor(cast(ltrim("session", 'S') AS float))+2)
              AND floor(cast(ltrim("session", 'S') AS float))+1 NOT IN (floor(cast(ltrim("session", 'S') AS float)),
                                                                        floor(cast(ltrim("session", 'S') AS float))+2)))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A8_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS NULL
       OR (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 = floor(cast(ltrim("session", 'S') AS DOUBLE))+1
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS NOT DISTINCT
           FROM floor(cast(ltrim("session", 'S') AS DOUBLE))+1
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <> floor(cast(ltrim("session", 'S') AS DOUBLE))
           AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS DISTINCT
                FROM floor(cast(ltrim("session", 'S') AS DOUBLE)))
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 > floor(cast(ltrim("session", 'S') AS DOUBLE))
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 >= floor(cast(ltrim("session", 'S') AS DOUBLE))
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 < floor(cast(ltrim("session", 'S') AS DOUBLE))+2
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <= floor(cast(ltrim("session", 'S') AS DOUBLE))+2
           AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <> floor(cast(ltrim("session", 'S') AS DOUBLE))) IS TRUE
           AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 = floor(cast(ltrim("session", 'S') AS DOUBLE))) IS NOT TRUE
           AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 = floor(cast(ltrim("session", 'S') AS DOUBLE))) IS FALSE
           AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <> floor(cast(ltrim("session", 'S') AS DOUBLE))) IS NOT FALSE
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 BETWEEN floor(cast(ltrim("session", 'S') AS DOUBLE)) AND floor(cast(ltrim("session", 'S') AS DOUBLE))+2
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 NOT BETWEEN floor(cast(ltrim("session", 'S') AS DOUBLE))+1 AND floor(cast(ltrim("session", 'S') AS DOUBLE))
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 like '%'
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 not like '__DOES_NOT_EXIST__%'
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IN (floor(cast(ltrim("session", 'S') AS DOUBLE)),
                                                                  floor(cast(ltrim("session", 'S') AS DOUBLE))+1,
                                                                  floor(cast(ltrim("session", 'S') AS DOUBLE))+2)
           AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 NOT IN (floor(cast(ltrim("session", 'S') AS DOUBLE)),
                                                                      floor(cast(ltrim("session", 'S') AS DOUBLE))+2))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A8_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS NULL
       OR floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IN
         (SELECT floor(cast(ltrim("session", 'S') AS DOUBLE))+1
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS NULL
                 OR (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 = floor(cast(ltrim("session", 'S') AS DOUBLE))+1
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS NOT DISTINCT
                     FROM floor(cast(ltrim("session", 'S') AS DOUBLE))+1
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <> floor(cast(ltrim("session", 'S') AS DOUBLE))
                     AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS DISTINCT
                          FROM floor(cast(ltrim("session", 'S') AS DOUBLE)))
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 > floor(cast(ltrim("session", 'S') AS DOUBLE))
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 >= floor(cast(ltrim("session", 'S') AS DOUBLE))
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 < floor(cast(ltrim("session", 'S') AS DOUBLE))+2
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <= floor(cast(ltrim("session", 'S') AS DOUBLE))+2
                     AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <> floor(cast(ltrim("session", 'S') AS DOUBLE))) IS TRUE
                     AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 = floor(cast(ltrim("session", 'S') AS DOUBLE))) IS NOT TRUE
                     AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 = floor(cast(ltrim("session", 'S') AS DOUBLE))) IS FALSE
                     AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <> floor(cast(ltrim("session", 'S') AS DOUBLE))) IS NOT FALSE
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 BETWEEN floor(cast(ltrim("session", 'S') AS DOUBLE)) AND floor(cast(ltrim("session", 'S') AS DOUBLE))+2
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 NOT BETWEEN floor(cast(ltrim("session", 'S') AS DOUBLE))+1 AND floor(cast(ltrim("session", 'S') AS DOUBLE))
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 like '%'
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 not like '__DOES_NOT_EXIST__%'
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IN (floor(cast(ltrim("session", 'S') AS DOUBLE)),
                                                                            floor(cast(ltrim("session", 'S') AS DOUBLE))+1,
                                                                            floor(cast(ltrim("session", 'S') AS DOUBLE))+2)
                     AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 NOT IN (floor(cast(ltrim("session", 'S') AS DOUBLE)),
                                                                                floor(cast(ltrim("session", 'S') AS DOUBLE))+2)))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A8_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          floor(cast(ltrim("session", 'S') AS DOUBLE))+1,
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS NULL
          OR (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 = floor(cast(ltrim("session", 'S') AS DOUBLE))+1
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS NOT DISTINCT
              FROM floor(cast(ltrim("session", 'S') AS DOUBLE))+1
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <> floor(cast(ltrim("session", 'S') AS DOUBLE))
              AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IS DISTINCT
                   FROM floor(cast(ltrim("session", 'S') AS DOUBLE)))
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 > floor(cast(ltrim("session", 'S') AS DOUBLE))
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 >= floor(cast(ltrim("session", 'S') AS DOUBLE))
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 < floor(cast(ltrim("session", 'S') AS DOUBLE))+2
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <= floor(cast(ltrim("session", 'S') AS DOUBLE))+2
              AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <> floor(cast(ltrim("session", 'S') AS DOUBLE))) IS TRUE
              AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 = floor(cast(ltrim("session", 'S') AS DOUBLE))) IS NOT TRUE
              AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 = floor(cast(ltrim("session", 'S') AS DOUBLE))) IS FALSE
              AND (floor(cast(ltrim("session", 'S') AS DOUBLE))+1 <> floor(cast(ltrim("session", 'S') AS DOUBLE))) IS NOT FALSE
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 BETWEEN floor(cast(ltrim("session", 'S') AS DOUBLE)) AND floor(cast(ltrim("session", 'S') AS DOUBLE))+2
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 NOT BETWEEN floor(cast(ltrim("session", 'S') AS DOUBLE))+1 AND floor(cast(ltrim("session", 'S') AS DOUBLE))
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 like '%'
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 not like '__DOES_NOT_EXIST__%'
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 IN (floor(cast(ltrim("session", 'S') AS DOUBLE)),
                                                                     floor(cast(ltrim("session", 'S') AS DOUBLE))+1,
                                                                     floor(cast(ltrim("session", 'S') AS DOUBLE))+2)
              AND floor(cast(ltrim("session", 'S') AS DOUBLE))+1 NOT IN (floor(cast(ltrim("session", 'S') AS DOUBLE)),
                                                                         floor(cast(ltrim("session", 'S') AS DOUBLE))+2)))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A9_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS NULL
       OR ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) = 1||cast(cast(ltrim("session", 'S') AS boolean) AS char)
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS NOT DISTINCT
           FROM 1||cast(cast(ltrim("session", 'S') AS boolean) AS char)
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <> '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
           AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS DISTINCT
                FROM '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char))
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) > '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) >= '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) < 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <= 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)
           AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <> '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS TRUE
           AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) = '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS NOT TRUE
           AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) = '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS FALSE
           AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <> '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS NOT FALSE
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) BETWEEN '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char) AND 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) NOT BETWEEN '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) AND '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) like '%'
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) not like '__DOES_NOT_EXIST__%'
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IN ('0'||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                                                                             1||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                                                                             2||cast(cast(ltrim("session", 'S') AS boolean) AS char))
           AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) NOT IN ('0'||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                                                                                 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A9_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS NULL
       OR '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IN
         (SELECT '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS NULL
                 OR ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) = 1||cast(cast(ltrim("session", 'S') AS boolean) AS char)
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS NOT DISTINCT
                     FROM 1||cast(cast(ltrim("session", 'S') AS boolean) AS char)
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <> '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
                     AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS DISTINCT
                          FROM '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char))
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) > '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) >= '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) < 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <= 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)
                     AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <> '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS TRUE
                     AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) = '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS NOT TRUE
                     AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) = '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS FALSE
                     AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <> '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS NOT FALSE
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) BETWEEN '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char) AND 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) NOT BETWEEN '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) AND '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) like '%'
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) not like '__DOES_NOT_EXIST__%'
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IN ('0'||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                                                                                       1||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                                                                                       2||cast(cast(ltrim("session", 'S') AS boolean) AS char))
                     AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) NOT IN ('0'||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                                                                                           2||cast(cast(ltrim("session", 'S') AS boolean) AS char))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A9_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS NULL
          OR ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) = 1||cast(cast(ltrim("session", 'S') AS boolean) AS char)
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS NOT DISTINCT
              FROM 1||cast(cast(ltrim("session", 'S') AS boolean) AS char)
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <> '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
              AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IS DISTINCT
                   FROM '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char))
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) > '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) >= '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) < 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <= 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)
              AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <> '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS TRUE
              AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) = '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS NOT TRUE
              AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) = '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS FALSE
              AND ('1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) <> '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)) IS NOT FALSE
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) BETWEEN '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char) AND 2||cast(cast(ltrim("session", 'S') AS boolean) AS char)
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) NOT BETWEEN '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) AND '0'||cast(cast(ltrim("session", 'S') AS boolean) AS char)
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) like '%'
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) not like '__DOES_NOT_EXIST__%'
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) IN ('0'||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                                                                                1||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                                                                                2||cast(cast(ltrim("session", 'S') AS boolean) AS char))
              AND '1'||cast(cast(ltrim("session", 'S') AS boolean) AS char) NOT IN ('0'||cast(cast(ltrim("session", 'S') AS boolean) AS char),
                                                                                    2||cast(cast(ltrim("session", 'S') AS boolean) AS char))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A10_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND (cast(session_length AS timestamp) IS NULL
       OR (cast(session_length AS timestamp) = cast(session_length AS timestamp)
           AND cast(session_length AS timestamp) IS NOT DISTINCT
           FROM cast(session_length AS timestamp)
           AND cast(session_length AS timestamp) <> cast(session_length AS timestamp) - interval '2' YEAR
           AND (cast(session_length AS timestamp) IS DISTINCT
                FROM cast(session_length AS timestamp) - interval '2' YEAR)
           AND cast(session_length AS timestamp) > cast(session_length AS timestamp) - interval '2' YEAR
           AND cast(session_length AS timestamp) >= cast(session_length AS timestamp) - interval '2' YEAR
           AND cast(session_length AS timestamp) < cast(session_length AS timestamp) + interval '2' YEAR
           AND cast(session_length AS timestamp) <= cast(session_length AS timestamp) + interval '2' YEAR
           AND (cast(session_length AS timestamp) <> cast(session_length AS timestamp) - interval '2' YEAR) IS TRUE
           AND (cast(session_length AS timestamp) = cast(session_length AS timestamp) - interval '2' YEAR) IS NOT TRUE
           AND (cast(session_length AS timestamp) = cast(session_length AS timestamp) - interval '2' YEAR) IS FALSE
           AND (cast(session_length AS timestamp) <> cast(session_length AS timestamp) - interval '2' YEAR) IS NOT FALSE
           AND cast(session_length AS timestamp) BETWEEN cast(session_length AS timestamp) - interval '2' YEAR AND cast(session_length AS timestamp) + interval '2' YEAR
           AND cast(session_length AS timestamp) NOT BETWEEN cast(session_length AS timestamp) AND cast(session_length AS timestamp) - interval '2' YEAR
           AND cast(session_length AS timestamp) like '%'
           AND cast(session_length AS timestamp) not like '__DOES_NOT_EXIST__%'
           AND cast(session_length AS timestamp) IN (cast(session_length AS timestamp) - interval '2' YEAR,
                                                     cast(session_length AS timestamp),
                                                     cast(session_length AS timestamp) + interval '2' YEAR)
           AND cast(session_length AS timestamp) NOT IN (cast(session_length AS timestamp) - interval '2' YEAR,
                                                         cast(session_length AS timestamp) + interval '2' YEAR))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A10_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND (cast(session_length AS timestamp) IS NULL
       OR cast(session_length AS timestamp) IN
         (SELECT cast(session_length AS timestamp)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND (cast(session_length AS timestamp) IS NULL
                 OR (cast(session_length AS timestamp) = cast(session_length AS timestamp)
                     AND cast(session_length AS timestamp) IS NOT DISTINCT
                     FROM cast(session_length AS timestamp)
                     AND cast(session_length AS timestamp) <> cast(session_length AS timestamp) - interval '2' YEAR
                     AND (cast(session_length AS timestamp) IS DISTINCT
                          FROM cast(session_length AS timestamp) - interval '2' YEAR)
                     AND cast(session_length AS timestamp) > cast(session_length AS timestamp) - interval '2' YEAR
                     AND cast(session_length AS timestamp) >= cast(session_length AS timestamp) - interval '2' YEAR
                     AND cast(session_length AS timestamp) < cast(session_length AS timestamp) + interval '2' YEAR
                     AND cast(session_length AS timestamp) <= cast(session_length AS timestamp) + interval '2' YEAR
                     AND (cast(session_length AS timestamp) <> cast(session_length AS timestamp) - interval '2' YEAR) IS TRUE
                     AND (cast(session_length AS timestamp) = cast(session_length AS timestamp) - interval '2' YEAR) IS NOT TRUE
                     AND (cast(session_length AS timestamp) = cast(session_length AS timestamp) - interval '2' YEAR) IS FALSE
                     AND (cast(session_length AS timestamp) <> cast(session_length AS timestamp) - interval '2' YEAR) IS NOT FALSE
                     AND cast(session_length AS timestamp) BETWEEN cast(session_length AS timestamp) - interval '2' YEAR AND cast(session_length AS timestamp) + interval '2' YEAR
                     AND cast(session_length AS timestamp) NOT BETWEEN cast(session_length AS timestamp) AND cast(session_length AS timestamp) - interval '2' YEAR
                     AND cast(session_length AS timestamp) like '%'
                     AND cast(session_length AS timestamp) not like '__DOES_NOT_EXIST__%'
                     AND cast(session_length AS timestamp) IN (cast(session_length AS timestamp) - interval '2' YEAR,
                                                               cast(session_length AS timestamp),
                                                               cast(session_length AS timestamp) + interval '2' YEAR)
                     AND cast(session_length AS timestamp) NOT IN (cast(session_length AS timestamp) - interval '2' YEAR,
                                                                   cast(session_length AS timestamp) + interval '2' YEAR)))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A10_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          cast(session_length AS timestamp),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND (cast(session_length AS timestamp) IS NULL
          OR (cast(session_length AS timestamp) = cast(session_length AS timestamp)
              AND cast(session_length AS timestamp) IS NOT DISTINCT
              FROM cast(session_length AS timestamp)
              AND cast(session_length AS timestamp) <> cast(session_length AS timestamp) - interval '2' YEAR
              AND (cast(session_length AS timestamp) IS DISTINCT
                   FROM cast(session_length AS timestamp) - interval '2' YEAR)
              AND cast(session_length AS timestamp) > cast(session_length AS timestamp) - interval '2' YEAR
              AND cast(session_length AS timestamp) >= cast(session_length AS timestamp) - interval '2' YEAR
              AND cast(session_length AS timestamp) < cast(session_length AS timestamp) + interval '2' YEAR
              AND cast(session_length AS timestamp) <= cast(session_length AS timestamp) + interval '2' YEAR
              AND (cast(session_length AS timestamp) <> cast(session_length AS timestamp) - interval '2' YEAR) IS TRUE
              AND (cast(session_length AS timestamp) = cast(session_length AS timestamp) - interval '2' YEAR) IS NOT TRUE
              AND (cast(session_length AS timestamp) = cast(session_length AS timestamp) - interval '2' YEAR) IS FALSE
              AND (cast(session_length AS timestamp) <> cast(session_length AS timestamp) - interval '2' YEAR) IS NOT FALSE
              AND cast(session_length AS timestamp) BETWEEN cast(session_length AS timestamp) - interval '2' YEAR AND cast(session_length AS timestamp) + interval '2' YEAR
              AND cast(session_length AS timestamp) NOT BETWEEN cast(session_length AS timestamp) AND cast(session_length AS timestamp) - interval '2' YEAR
              AND cast(session_length AS timestamp) like '%'
              AND cast(session_length AS timestamp) not like '__DOES_NOT_EXIST__%'
              AND cast(session_length AS timestamp) IN (cast(session_length AS timestamp) - interval '2' YEAR,
                                                        cast(session_length AS timestamp),
                                                        cast(session_length AS timestamp) + interval '2' YEAR)
              AND cast(session_length AS timestamp) NOT IN (cast(session_length AS timestamp) - interval '2' YEAR,
                                                            cast(session_length AS timestamp) + interval '2' YEAR)))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A11_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||coalesce(client_ip, server_ip) IS NULL
       OR ('1'||coalesce(client_ip, server_ip) = 1||coalesce(client_ip, server_ip)
           AND '1'||coalesce(client_ip, server_ip) IS NOT DISTINCT
           FROM 1||coalesce(client_ip, server_ip)
           AND '1'||coalesce(client_ip, server_ip) <> '0'||coalesce(client_ip, server_ip)
           AND ('1'||coalesce(client_ip, server_ip) IS DISTINCT
                FROM '0'||coalesce(client_ip, server_ip))
           AND '1'||coalesce(client_ip, server_ip) > '0'||coalesce(client_ip, server_ip)
           AND '1'||coalesce(client_ip, server_ip) >= '0'||coalesce(client_ip, server_ip)
           AND '1'||coalesce(client_ip, server_ip) < 2||coalesce(client_ip, server_ip)
           AND '1'||coalesce(client_ip, server_ip) <= 2||coalesce(client_ip, server_ip)
           AND ('1'||coalesce(client_ip, server_ip) <> '0'||coalesce(client_ip, server_ip)) IS TRUE
           AND ('1'||coalesce(client_ip, server_ip) = '0'||coalesce(client_ip, server_ip)) IS NOT TRUE
           AND ('1'||coalesce(client_ip, server_ip) = '0'||coalesce(client_ip, server_ip)) IS FALSE
           AND ('1'||coalesce(client_ip, server_ip) <> '0'||coalesce(client_ip, server_ip)) IS NOT FALSE
           AND '1'||coalesce(client_ip, server_ip) BETWEEN '0'||coalesce(client_ip, server_ip) AND 2||coalesce(client_ip, server_ip)
           AND '1'||coalesce(client_ip, server_ip) NOT BETWEEN '1'||coalesce(client_ip, server_ip) AND '0'||coalesce(client_ip, server_ip)
           AND '1'||coalesce(client_ip, server_ip) like '%'
           AND '1'||coalesce(client_ip, server_ip) not like '__DOES_NOT_EXIST__%'
           AND '1'||coalesce(client_ip, server_ip) IN ('0'||coalesce(client_ip, server_ip),
                                                       1||coalesce(client_ip, server_ip),
                                                       2||coalesce(client_ip, server_ip))
           AND '1'||coalesce(client_ip, server_ip) NOT IN ('0'||coalesce(client_ip, server_ip),
                                                           2||coalesce(client_ip, server_ip)))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A11_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||coalesce(client_ip, server_ip) IS NULL
       OR '1'||coalesce(client_ip, server_ip) IN
         (SELECT '1'||coalesce(client_ip, server_ip)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||coalesce(client_ip, server_ip) IS NULL
                 OR ('1'||coalesce(client_ip, server_ip) = 1||coalesce(client_ip, server_ip)
                     AND '1'||coalesce(client_ip, server_ip) IS NOT DISTINCT
                     FROM 1||coalesce(client_ip, server_ip)
                     AND '1'||coalesce(client_ip, server_ip) <> '0'||coalesce(client_ip, server_ip)
                     AND ('1'||coalesce(client_ip, server_ip) IS DISTINCT
                          FROM '0'||coalesce(client_ip, server_ip))
                     AND '1'||coalesce(client_ip, server_ip) > '0'||coalesce(client_ip, server_ip)
                     AND '1'||coalesce(client_ip, server_ip) >= '0'||coalesce(client_ip, server_ip)
                     AND '1'||coalesce(client_ip, server_ip) < 2||coalesce(client_ip, server_ip)
                     AND '1'||coalesce(client_ip, server_ip) <= 2||coalesce(client_ip, server_ip)
                     AND ('1'||coalesce(client_ip, server_ip) <> '0'||coalesce(client_ip, server_ip)) IS TRUE
                     AND ('1'||coalesce(client_ip, server_ip) = '0'||coalesce(client_ip, server_ip)) IS NOT TRUE
                     AND ('1'||coalesce(client_ip, server_ip) = '0'||coalesce(client_ip, server_ip)) IS FALSE
                     AND ('1'||coalesce(client_ip, server_ip) <> '0'||coalesce(client_ip, server_ip)) IS NOT FALSE
                     AND '1'||coalesce(client_ip, server_ip) BETWEEN '0'||coalesce(client_ip, server_ip) AND 2||coalesce(client_ip, server_ip)
                     AND '1'||coalesce(client_ip, server_ip) NOT BETWEEN '1'||coalesce(client_ip, server_ip) AND '0'||coalesce(client_ip, server_ip)
                     AND '1'||coalesce(client_ip, server_ip) like '%'
                     AND '1'||coalesce(client_ip, server_ip) not like '__DOES_NOT_EXIST__%'
                     AND '1'||coalesce(client_ip, server_ip) IN ('0'||coalesce(client_ip, server_ip),
                                                                 1||coalesce(client_ip, server_ip),
                                                                 2||coalesce(client_ip, server_ip))
                     AND '1'||coalesce(client_ip, server_ip) NOT IN ('0'||coalesce(client_ip, server_ip),
                                                                     2||coalesce(client_ip, server_ip))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A11_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||coalesce(client_ip, server_ip),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||coalesce(client_ip, server_ip) IS NULL
          OR ('1'||coalesce(client_ip, server_ip) = 1||coalesce(client_ip, server_ip)
              AND '1'||coalesce(client_ip, server_ip) IS NOT DISTINCT
              FROM 1||coalesce(client_ip, server_ip)
              AND '1'||coalesce(client_ip, server_ip) <> '0'||coalesce(client_ip, server_ip)
              AND ('1'||coalesce(client_ip, server_ip) IS DISTINCT
                   FROM '0'||coalesce(client_ip, server_ip))
              AND '1'||coalesce(client_ip, server_ip) > '0'||coalesce(client_ip, server_ip)
              AND '1'||coalesce(client_ip, server_ip) >= '0'||coalesce(client_ip, server_ip)
              AND '1'||coalesce(client_ip, server_ip) < 2||coalesce(client_ip, server_ip)
              AND '1'||coalesce(client_ip, server_ip) <= 2||coalesce(client_ip, server_ip)
              AND ('1'||coalesce(client_ip, server_ip) <> '0'||coalesce(client_ip, server_ip)) IS TRUE
              AND ('1'||coalesce(client_ip, server_ip) = '0'||coalesce(client_ip, server_ip)) IS NOT TRUE
              AND ('1'||coalesce(client_ip, server_ip) = '0'||coalesce(client_ip, server_ip)) IS FALSE
              AND ('1'||coalesce(client_ip, server_ip) <> '0'||coalesce(client_ip, server_ip)) IS NOT FALSE
              AND '1'||coalesce(client_ip, server_ip) BETWEEN '0'||coalesce(client_ip, server_ip) AND 2||coalesce(client_ip, server_ip)
              AND '1'||coalesce(client_ip, server_ip) NOT BETWEEN '1'||coalesce(client_ip, server_ip) AND '0'||coalesce(client_ip, server_ip)
              AND '1'||coalesce(client_ip, server_ip) like '%'
              AND '1'||coalesce(client_ip, server_ip) not like '__DOES_NOT_EXIST__%'
              AND '1'||coalesce(client_ip, server_ip) IN ('0'||coalesce(client_ip, server_ip),
                                                          1||coalesce(client_ip, server_ip),
                                                          2||coalesce(client_ip, server_ip))
              AND '1'||coalesce(client_ip, server_ip) NOT IN ('0'||coalesce(client_ip, server_ip),
                                                              2||coalesce(client_ip, server_ip))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A12_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||to_json_string(coalesce(event, agent)) IS NULL
       OR ('1'||to_json_string(coalesce(event, agent)) = 1||to_json_string(coalesce(event, agent))
           AND '1'||to_json_string(coalesce(event, agent)) IS NOT DISTINCT
           FROM 1||to_json_string(coalesce(event, agent))
           AND '1'||to_json_string(coalesce(event, agent)) <> '0'||to_json_string(coalesce(event, agent))
           AND ('1'||to_json_string(coalesce(event, agent)) IS DISTINCT
                FROM '0'||to_json_string(coalesce(event, agent)))
           AND '1'||to_json_string(coalesce(event, agent)) > '0'||to_json_string(coalesce(event, agent))
           AND '1'||to_json_string(coalesce(event, agent)) >= '0'||to_json_string(coalesce(event, agent))
           AND '1'||to_json_string(coalesce(event, agent)) < 2||to_json_string(coalesce(event, agent))
           AND '1'||to_json_string(coalesce(event, agent)) <= 2||to_json_string(coalesce(event, agent))
           AND ('1'||to_json_string(coalesce(event, agent)) <> '0'||to_json_string(coalesce(event, agent))) IS TRUE
           AND ('1'||to_json_string(coalesce(event, agent)) = '0'||to_json_string(coalesce(event, agent))) IS NOT TRUE
           AND ('1'||to_json_string(coalesce(event, agent)) = '0'||to_json_string(coalesce(event, agent))) IS FALSE
           AND ('1'||to_json_string(coalesce(event, agent)) <> '0'||to_json_string(coalesce(event, agent))) IS NOT FALSE
           AND '1'||to_json_string(coalesce(event, agent)) BETWEEN '0'||to_json_string(coalesce(event, agent)) AND 2||to_json_string(coalesce(event, agent))
           AND '1'||to_json_string(coalesce(event, agent)) NOT BETWEEN '1'||to_json_string(coalesce(event, agent)) AND '0'||to_json_string(coalesce(event, agent))
           AND '1'||to_json_string(coalesce(event, agent)) like '%'
           AND '1'||to_json_string(coalesce(event, agent)) not like '__DOES_NOT_EXIST__%'
           AND '1'||to_json_string(coalesce(event, agent)) IN ('0'||to_json_string(coalesce(event, agent)),
                                                               1||to_json_string(coalesce(event, agent)),
                                                               2||to_json_string(coalesce(event, agent)))
           AND '1'||to_json_string(coalesce(event, agent)) NOT IN ('0'||to_json_string(coalesce(event, agent)),
                                                                   2||to_json_string(coalesce(event, agent))))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A12_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||to_json_string(coalesce(event, agent)) IS NULL
       OR '1'||to_json_string(coalesce(event, agent)) IN
         (SELECT '1'||to_json_string(coalesce(event, agent))
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||to_json_string(coalesce(event, agent)) IS NULL
                 OR ('1'||to_json_string(coalesce(event, agent)) = 1||to_json_string(coalesce(event, agent))
                     AND '1'||to_json_string(coalesce(event, agent)) IS NOT DISTINCT
                     FROM 1||to_json_string(coalesce(event, agent))
                     AND '1'||to_json_string(coalesce(event, agent)) <> '0'||to_json_string(coalesce(event, agent))
                     AND ('1'||to_json_string(coalesce(event, agent)) IS DISTINCT
                          FROM '0'||to_json_string(coalesce(event, agent)))
                     AND '1'||to_json_string(coalesce(event, agent)) > '0'||to_json_string(coalesce(event, agent))
                     AND '1'||to_json_string(coalesce(event, agent)) >= '0'||to_json_string(coalesce(event, agent))
                     AND '1'||to_json_string(coalesce(event, agent)) < 2||to_json_string(coalesce(event, agent))
                     AND '1'||to_json_string(coalesce(event, agent)) <= 2||to_json_string(coalesce(event, agent))
                     AND ('1'||to_json_string(coalesce(event, agent)) <> '0'||to_json_string(coalesce(event, agent))) IS TRUE
                     AND ('1'||to_json_string(coalesce(event, agent)) = '0'||to_json_string(coalesce(event, agent))) IS NOT TRUE
                     AND ('1'||to_json_string(coalesce(event, agent)) = '0'||to_json_string(coalesce(event, agent))) IS FALSE
                     AND ('1'||to_json_string(coalesce(event, agent)) <> '0'||to_json_string(coalesce(event, agent))) IS NOT FALSE
                     AND '1'||to_json_string(coalesce(event, agent)) BETWEEN '0'||to_json_string(coalesce(event, agent)) AND 2||to_json_string(coalesce(event, agent))
                     AND '1'||to_json_string(coalesce(event, agent)) NOT BETWEEN '1'||to_json_string(coalesce(event, agent)) AND '0'||to_json_string(coalesce(event, agent))
                     AND '1'||to_json_string(coalesce(event, agent)) like '%'
                     AND '1'||to_json_string(coalesce(event, agent)) not like '__DOES_NOT_EXIST__%'
                     AND '1'||to_json_string(coalesce(event, agent)) IN ('0'||to_json_string(coalesce(event, agent)),
                                                                         1||to_json_string(coalesce(event, agent)),
                                                                         2||to_json_string(coalesce(event, agent)))
                     AND '1'||to_json_string(coalesce(event, agent)) NOT IN ('0'||to_json_string(coalesce(event, agent)),
                                                                             2||to_json_string(coalesce(event, agent)))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A12_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||to_json_string(coalesce(event, agent)),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||to_json_string(coalesce(event, agent)) IS NULL
          OR ('1'||to_json_string(coalesce(event, agent)) = 1||to_json_string(coalesce(event, agent))
              AND '1'||to_json_string(coalesce(event, agent)) IS NOT DISTINCT
              FROM 1||to_json_string(coalesce(event, agent))
              AND '1'||to_json_string(coalesce(event, agent)) <> '0'||to_json_string(coalesce(event, agent))
              AND ('1'||to_json_string(coalesce(event, agent)) IS DISTINCT
                   FROM '0'||to_json_string(coalesce(event, agent)))
              AND '1'||to_json_string(coalesce(event, agent)) > '0'||to_json_string(coalesce(event, agent))
              AND '1'||to_json_string(coalesce(event, agent)) >= '0'||to_json_string(coalesce(event, agent))
              AND '1'||to_json_string(coalesce(event, agent)) < 2||to_json_string(coalesce(event, agent))
              AND '1'||to_json_string(coalesce(event, agent)) <= 2||to_json_string(coalesce(event, agent))
              AND ('1'||to_json_string(coalesce(event, agent)) <> '0'||to_json_string(coalesce(event, agent))) IS TRUE
              AND ('1'||to_json_string(coalesce(event, agent)) = '0'||to_json_string(coalesce(event, agent))) IS NOT TRUE
              AND ('1'||to_json_string(coalesce(event, agent)) = '0'||to_json_string(coalesce(event, agent))) IS FALSE
              AND ('1'||to_json_string(coalesce(event, agent)) <> '0'||to_json_string(coalesce(event, agent))) IS NOT FALSE
              AND '1'||to_json_string(coalesce(event, agent)) BETWEEN '0'||to_json_string(coalesce(event, agent)) AND 2||to_json_string(coalesce(event, agent))
              AND '1'||to_json_string(coalesce(event, agent)) NOT BETWEEN '1'||to_json_string(coalesce(event, agent)) AND '0'||to_json_string(coalesce(event, agent))
              AND '1'||to_json_string(coalesce(event, agent)) like '%'
              AND '1'||to_json_string(coalesce(event, agent)) not like '__DOES_NOT_EXIST__%'
              AND '1'||to_json_string(coalesce(event, agent)) IN ('0'||to_json_string(coalesce(event, agent)),
                                                                  1||to_json_string(coalesce(event, agent)),
                                                                  2||to_json_string(coalesce(event, agent)))
              AND '1'||to_json_string(coalesce(event, agent)) NOT IN ('0'||to_json_string(coalesce(event, agent)),
                                                                      2||to_json_string(coalesce(event, agent)))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A13_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||nullif(client_ip, server_ip) IS NULL
       OR ('1'||nullif(client_ip, server_ip) = 1||nullif(client_ip, server_ip)
           AND '1'||nullif(client_ip, server_ip) IS NOT DISTINCT
           FROM 1||nullif(client_ip, server_ip)
           AND '1'||nullif(client_ip, server_ip) <> '0'||nullif(client_ip, server_ip)
           AND ('1'||nullif(client_ip, server_ip) IS DISTINCT
                FROM '0'||nullif(client_ip, server_ip))
           AND '1'||nullif(client_ip, server_ip) > '0'||nullif(client_ip, server_ip)
           AND '1'||nullif(client_ip, server_ip) >= '0'||nullif(client_ip, server_ip)
           AND '1'||nullif(client_ip, server_ip) < 2||nullif(client_ip, server_ip)
           AND '1'||nullif(client_ip, server_ip) <= 2||nullif(client_ip, server_ip)
           AND ('1'||nullif(client_ip, server_ip) <> '0'||nullif(client_ip, server_ip)) IS TRUE
           AND ('1'||nullif(client_ip, server_ip) = '0'||nullif(client_ip, server_ip)) IS NOT TRUE
           AND ('1'||nullif(client_ip, server_ip) = '0'||nullif(client_ip, server_ip)) IS FALSE
           AND ('1'||nullif(client_ip, server_ip) <> '0'||nullif(client_ip, server_ip)) IS NOT FALSE
           AND '1'||nullif(client_ip, server_ip) BETWEEN '0'||nullif(client_ip, server_ip) AND 2||nullif(client_ip, server_ip)
           AND '1'||nullif(client_ip, server_ip) NOT BETWEEN '1'||nullif(client_ip, server_ip) AND '0'||nullif(client_ip, server_ip)
           AND '1'||nullif(client_ip, server_ip) like '%'
           AND '1'||nullif(client_ip, server_ip) not like '__DOES_NOT_EXIST__%'
           AND '1'||nullif(client_ip, server_ip) IN ('0'||nullif(client_ip, server_ip),
                                                     1||nullif(client_ip, server_ip),
                                                     2||nullif(client_ip, server_ip))
           AND '1'||nullif(client_ip, server_ip) NOT IN ('0'||nullif(client_ip, server_ip),
                                                         2||nullif(client_ip, server_ip)))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A13_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||nullif(client_ip, server_ip) IS NULL
       OR '1'||nullif(client_ip, server_ip) IN
         (SELECT '1'||nullif(client_ip, server_ip)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||nullif(client_ip, server_ip) IS NULL
                 OR ('1'||nullif(client_ip, server_ip) = 1||nullif(client_ip, server_ip)
                     AND '1'||nullif(client_ip, server_ip) IS NOT DISTINCT
                     FROM 1||nullif(client_ip, server_ip)
                     AND '1'||nullif(client_ip, server_ip) <> '0'||nullif(client_ip, server_ip)
                     AND ('1'||nullif(client_ip, server_ip) IS DISTINCT
                          FROM '0'||nullif(client_ip, server_ip))
                     AND '1'||nullif(client_ip, server_ip) > '0'||nullif(client_ip, server_ip)
                     AND '1'||nullif(client_ip, server_ip) >= '0'||nullif(client_ip, server_ip)
                     AND '1'||nullif(client_ip, server_ip) < 2||nullif(client_ip, server_ip)
                     AND '1'||nullif(client_ip, server_ip) <= 2||nullif(client_ip, server_ip)
                     AND ('1'||nullif(client_ip, server_ip) <> '0'||nullif(client_ip, server_ip)) IS TRUE
                     AND ('1'||nullif(client_ip, server_ip) = '0'||nullif(client_ip, server_ip)) IS NOT TRUE
                     AND ('1'||nullif(client_ip, server_ip) = '0'||nullif(client_ip, server_ip)) IS FALSE
                     AND ('1'||nullif(client_ip, server_ip) <> '0'||nullif(client_ip, server_ip)) IS NOT FALSE
                     AND '1'||nullif(client_ip, server_ip) BETWEEN '0'||nullif(client_ip, server_ip) AND 2||nullif(client_ip, server_ip)
                     AND '1'||nullif(client_ip, server_ip) NOT BETWEEN '1'||nullif(client_ip, server_ip) AND '0'||nullif(client_ip, server_ip)
                     AND '1'||nullif(client_ip, server_ip) like '%'
                     AND '1'||nullif(client_ip, server_ip) not like '__DOES_NOT_EXIST__%'
                     AND '1'||nullif(client_ip, server_ip) IN ('0'||nullif(client_ip, server_ip),
                                                               1||nullif(client_ip, server_ip),
                                                               2||nullif(client_ip, server_ip))
                     AND '1'||nullif(client_ip, server_ip) NOT IN ('0'||nullif(client_ip, server_ip),
                                                                   2||nullif(client_ip, server_ip))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A13_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||nullif(client_ip, server_ip),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||nullif(client_ip, server_ip) IS NULL
          OR ('1'||nullif(client_ip, server_ip) = 1||nullif(client_ip, server_ip)
              AND '1'||nullif(client_ip, server_ip) IS NOT DISTINCT
              FROM 1||nullif(client_ip, server_ip)
              AND '1'||nullif(client_ip, server_ip) <> '0'||nullif(client_ip, server_ip)
              AND ('1'||nullif(client_ip, server_ip) IS DISTINCT
                   FROM '0'||nullif(client_ip, server_ip))
              AND '1'||nullif(client_ip, server_ip) > '0'||nullif(client_ip, server_ip)
              AND '1'||nullif(client_ip, server_ip) >= '0'||nullif(client_ip, server_ip)
              AND '1'||nullif(client_ip, server_ip) < 2||nullif(client_ip, server_ip)
              AND '1'||nullif(client_ip, server_ip) <= 2||nullif(client_ip, server_ip)
              AND ('1'||nullif(client_ip, server_ip) <> '0'||nullif(client_ip, server_ip)) IS TRUE
              AND ('1'||nullif(client_ip, server_ip) = '0'||nullif(client_ip, server_ip)) IS NOT TRUE
              AND ('1'||nullif(client_ip, server_ip) = '0'||nullif(client_ip, server_ip)) IS FALSE
              AND ('1'||nullif(client_ip, server_ip) <> '0'||nullif(client_ip, server_ip)) IS NOT FALSE
              AND '1'||nullif(client_ip, server_ip) BETWEEN '0'||nullif(client_ip, server_ip) AND 2||nullif(client_ip, server_ip)
              AND '1'||nullif(client_ip, server_ip) NOT BETWEEN '1'||nullif(client_ip, server_ip) AND '0'||nullif(client_ip, server_ip)
              AND '1'||nullif(client_ip, server_ip) like '%'
              AND '1'||nullif(client_ip, server_ip) not like '__DOES_NOT_EXIST__%'
              AND '1'||nullif(client_ip, server_ip) IN ('0'||nullif(client_ip, server_ip),
                                                        1||nullif(client_ip, server_ip),
                                                        2||nullif(client_ip, server_ip))
              AND '1'||nullif(client_ip, server_ip) NOT IN ('0'||nullif(client_ip, server_ip),
                                                            2||nullif(client_ip, server_ip))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A14_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||to_json_string(nullif(event, agent)) IS NULL
       OR ('1'||to_json_string(nullif(event, agent)) = 1||to_json_string(nullif(event, agent))
           AND '1'||to_json_string(nullif(event, agent)) IS NOT DISTINCT
           FROM 1||to_json_string(nullif(event, agent))
           AND '1'||to_json_string(nullif(event, agent)) <> '0'||to_json_string(nullif(event, agent))
           AND ('1'||to_json_string(nullif(event, agent)) IS DISTINCT
                FROM '0'||to_json_string(nullif(event, agent)))
           AND '1'||to_json_string(nullif(event, agent)) > '0'||to_json_string(nullif(event, agent))
           AND '1'||to_json_string(nullif(event, agent)) >= '0'||to_json_string(nullif(event, agent))
           AND '1'||to_json_string(nullif(event, agent)) < 2||to_json_string(nullif(event, agent))
           AND '1'||to_json_string(nullif(event, agent)) <= 2||to_json_string(nullif(event, agent))
           AND ('1'||to_json_string(nullif(event, agent)) <> '0'||to_json_string(nullif(event, agent))) IS TRUE
           AND ('1'||to_json_string(nullif(event, agent)) = '0'||to_json_string(nullif(event, agent))) IS NOT TRUE
           AND ('1'||to_json_string(nullif(event, agent)) = '0'||to_json_string(nullif(event, agent))) IS FALSE
           AND ('1'||to_json_string(nullif(event, agent)) <> '0'||to_json_string(nullif(event, agent))) IS NOT FALSE
           AND '1'||to_json_string(nullif(event, agent)) BETWEEN '0'||to_json_string(nullif(event, agent)) AND 2||to_json_string(nullif(event, agent))
           AND '1'||to_json_string(nullif(event, agent)) NOT BETWEEN '1'||to_json_string(nullif(event, agent)) AND '0'||to_json_string(nullif(event, agent))
           AND '1'||to_json_string(nullif(event, agent)) like '%'
           AND '1'||to_json_string(nullif(event, agent)) not like '__DOES_NOT_EXIST__%'
           AND '1'||to_json_string(nullif(event, agent)) IN ('0'||to_json_string(nullif(event, agent)),
                                                             1||to_json_string(nullif(event, agent)),
                                                             2||to_json_string(nullif(event, agent)))
           AND '1'||to_json_string(nullif(event, agent)) NOT IN ('0'||to_json_string(nullif(event, agent)),
                                                                 2||to_json_string(nullif(event, agent))))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A14_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||to_json_string(nullif(event, agent)) IS NULL
       OR '1'||to_json_string(nullif(event, agent)) IN
         (SELECT '1'||to_json_string(nullif(event, agent))
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||to_json_string(nullif(event, agent)) IS NULL
                 OR ('1'||to_json_string(nullif(event, agent)) = 1||to_json_string(nullif(event, agent))
                     AND '1'||to_json_string(nullif(event, agent)) IS NOT DISTINCT
                     FROM 1||to_json_string(nullif(event, agent))
                     AND '1'||to_json_string(nullif(event, agent)) <> '0'||to_json_string(nullif(event, agent))
                     AND ('1'||to_json_string(nullif(event, agent)) IS DISTINCT
                          FROM '0'||to_json_string(nullif(event, agent)))
                     AND '1'||to_json_string(nullif(event, agent)) > '0'||to_json_string(nullif(event, agent))
                     AND '1'||to_json_string(nullif(event, agent)) >= '0'||to_json_string(nullif(event, agent))
                     AND '1'||to_json_string(nullif(event, agent)) < 2||to_json_string(nullif(event, agent))
                     AND '1'||to_json_string(nullif(event, agent)) <= 2||to_json_string(nullif(event, agent))
                     AND ('1'||to_json_string(nullif(event, agent)) <> '0'||to_json_string(nullif(event, agent))) IS TRUE
                     AND ('1'||to_json_string(nullif(event, agent)) = '0'||to_json_string(nullif(event, agent))) IS NOT TRUE
                     AND ('1'||to_json_string(nullif(event, agent)) = '0'||to_json_string(nullif(event, agent))) IS FALSE
                     AND ('1'||to_json_string(nullif(event, agent)) <> '0'||to_json_string(nullif(event, agent))) IS NOT FALSE
                     AND '1'||to_json_string(nullif(event, agent)) BETWEEN '0'||to_json_string(nullif(event, agent)) AND 2||to_json_string(nullif(event, agent))
                     AND '1'||to_json_string(nullif(event, agent)) NOT BETWEEN '1'||to_json_string(nullif(event, agent)) AND '0'||to_json_string(nullif(event, agent))
                     AND '1'||to_json_string(nullif(event, agent)) like '%'
                     AND '1'||to_json_string(nullif(event, agent)) not like '__DOES_NOT_EXIST__%'
                     AND '1'||to_json_string(nullif(event, agent)) IN ('0'||to_json_string(nullif(event, agent)),
                                                                       1||to_json_string(nullif(event, agent)),
                                                                       2||to_json_string(nullif(event, agent)))
                     AND '1'||to_json_string(nullif(event, agent)) NOT IN ('0'||to_json_string(nullif(event, agent)),
                                                                           2||to_json_string(nullif(event, agent)))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A14_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||to_json_string(nullif(event, agent)),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||to_json_string(nullif(event, agent)) IS NULL
          OR ('1'||to_json_string(nullif(event, agent)) = 1||to_json_string(nullif(event, agent))
              AND '1'||to_json_string(nullif(event, agent)) IS NOT DISTINCT
              FROM 1||to_json_string(nullif(event, agent))
              AND '1'||to_json_string(nullif(event, agent)) <> '0'||to_json_string(nullif(event, agent))
              AND ('1'||to_json_string(nullif(event, agent)) IS DISTINCT
                   FROM '0'||to_json_string(nullif(event, agent)))
              AND '1'||to_json_string(nullif(event, agent)) > '0'||to_json_string(nullif(event, agent))
              AND '1'||to_json_string(nullif(event, agent)) >= '0'||to_json_string(nullif(event, agent))
              AND '1'||to_json_string(nullif(event, agent)) < 2||to_json_string(nullif(event, agent))
              AND '1'||to_json_string(nullif(event, agent)) <= 2||to_json_string(nullif(event, agent))
              AND ('1'||to_json_string(nullif(event, agent)) <> '0'||to_json_string(nullif(event, agent))) IS TRUE
              AND ('1'||to_json_string(nullif(event, agent)) = '0'||to_json_string(nullif(event, agent))) IS NOT TRUE
              AND ('1'||to_json_string(nullif(event, agent)) = '0'||to_json_string(nullif(event, agent))) IS FALSE
              AND ('1'||to_json_string(nullif(event, agent)) <> '0'||to_json_string(nullif(event, agent))) IS NOT FALSE
              AND '1'||to_json_string(nullif(event, agent)) BETWEEN '0'||to_json_string(nullif(event, agent)) AND 2||to_json_string(nullif(event, agent))
              AND '1'||to_json_string(nullif(event, agent)) NOT BETWEEN '1'||to_json_string(nullif(event, agent)) AND '0'||to_json_string(nullif(event, agent))
              AND '1'||to_json_string(nullif(event, agent)) like '%'
              AND '1'||to_json_string(nullif(event, agent)) not like '__DOES_NOT_EXIST__%'
              AND '1'||to_json_string(nullif(event, agent)) IN ('0'||to_json_string(nullif(event, agent)),
                                                                1||to_json_string(nullif(event, agent)),
                                                                2||to_json_string(nullif(event, agent)))
              AND '1'||to_json_string(nullif(event, agent)) NOT IN ('0'||to_json_string(nullif(event, agent)),
                                                                    2||to_json_string(nullif(event, agent)))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A15_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||nvl(client_ip, server_ip) IS NULL
       OR ('1'||nvl(client_ip, server_ip) = 1||nvl(client_ip, server_ip)
           AND '1'||nvl(client_ip, server_ip) IS NOT DISTINCT
           FROM 1||nvl(client_ip, server_ip)
           AND '1'||nvl(client_ip, server_ip) <> '0'||nvl(client_ip, server_ip)
           AND ('1'||nvl(client_ip, server_ip) IS DISTINCT
                FROM '0'||nvl(client_ip, server_ip))
           AND '1'||nvl(client_ip, server_ip) > '0'||nvl(client_ip, server_ip)
           AND '1'||nvl(client_ip, server_ip) >= '0'||nvl(client_ip, server_ip)
           AND '1'||nvl(client_ip, server_ip) < 2||nvl(client_ip, server_ip)
           AND '1'||nvl(client_ip, server_ip) <= 2||nvl(client_ip, server_ip)
           AND ('1'||nvl(client_ip, server_ip) <> '0'||nvl(client_ip, server_ip)) IS TRUE
           AND ('1'||nvl(client_ip, server_ip) = '0'||nvl(client_ip, server_ip)) IS NOT TRUE
           AND ('1'||nvl(client_ip, server_ip) = '0'||nvl(client_ip, server_ip)) IS FALSE
           AND ('1'||nvl(client_ip, server_ip) <> '0'||nvl(client_ip, server_ip)) IS NOT FALSE
           AND '1'||nvl(client_ip, server_ip) BETWEEN '0'||nvl(client_ip, server_ip) AND 2||nvl(client_ip, server_ip)
           AND '1'||nvl(client_ip, server_ip) NOT BETWEEN '1'||nvl(client_ip, server_ip) AND '0'||nvl(client_ip, server_ip)
           AND '1'||nvl(client_ip, server_ip) like '%'
           AND '1'||nvl(client_ip, server_ip) not like '__DOES_NOT_EXIST__%'
           AND '1'||nvl(client_ip, server_ip) IN ('0'||nvl(client_ip, server_ip),
                                                  1||nvl(client_ip, server_ip),
                                                  2||nvl(client_ip, server_ip))
           AND '1'||nvl(client_ip, server_ip) NOT IN ('0'||nvl(client_ip, server_ip),
                                                      2||nvl(client_ip, server_ip)))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A15_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||nvl(client_ip, server_ip) IS NULL
       OR '1'||nvl(client_ip, server_ip) IN
         (SELECT '1'||nvl(client_ip, server_ip)
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||nvl(client_ip, server_ip) IS NULL
                 OR ('1'||nvl(client_ip, server_ip) = 1||nvl(client_ip, server_ip)
                     AND '1'||nvl(client_ip, server_ip) IS NOT DISTINCT
                     FROM 1||nvl(client_ip, server_ip)
                     AND '1'||nvl(client_ip, server_ip) <> '0'||nvl(client_ip, server_ip)
                     AND ('1'||nvl(client_ip, server_ip) IS DISTINCT
                          FROM '0'||nvl(client_ip, server_ip))
                     AND '1'||nvl(client_ip, server_ip) > '0'||nvl(client_ip, server_ip)
                     AND '1'||nvl(client_ip, server_ip) >= '0'||nvl(client_ip, server_ip)
                     AND '1'||nvl(client_ip, server_ip) < 2||nvl(client_ip, server_ip)
                     AND '1'||nvl(client_ip, server_ip) <= 2||nvl(client_ip, server_ip)
                     AND ('1'||nvl(client_ip, server_ip) <> '0'||nvl(client_ip, server_ip)) IS TRUE
                     AND ('1'||nvl(client_ip, server_ip) = '0'||nvl(client_ip, server_ip)) IS NOT TRUE
                     AND ('1'||nvl(client_ip, server_ip) = '0'||nvl(client_ip, server_ip)) IS FALSE
                     AND ('1'||nvl(client_ip, server_ip) <> '0'||nvl(client_ip, server_ip)) IS NOT FALSE
                     AND '1'||nvl(client_ip, server_ip) BETWEEN '0'||nvl(client_ip, server_ip) AND 2||nvl(client_ip, server_ip)
                     AND '1'||nvl(client_ip, server_ip) NOT BETWEEN '1'||nvl(client_ip, server_ip) AND '0'||nvl(client_ip, server_ip)
                     AND '1'||nvl(client_ip, server_ip) like '%'
                     AND '1'||nvl(client_ip, server_ip) not like '__DOES_NOT_EXIST__%'
                     AND '1'||nvl(client_ip, server_ip) IN ('0'||nvl(client_ip, server_ip),
                                                            1||nvl(client_ip, server_ip),
                                                            2||nvl(client_ip, server_ip))
                     AND '1'||nvl(client_ip, server_ip) NOT IN ('0'||nvl(client_ip, server_ip),
                                                                2||nvl(client_ip, server_ip))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A15_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||nvl(client_ip, server_ip),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||nvl(client_ip, server_ip) IS NULL
          OR ('1'||nvl(client_ip, server_ip) = 1||nvl(client_ip, server_ip)
              AND '1'||nvl(client_ip, server_ip) IS NOT DISTINCT
              FROM 1||nvl(client_ip, server_ip)
              AND '1'||nvl(client_ip, server_ip) <> '0'||nvl(client_ip, server_ip)
              AND ('1'||nvl(client_ip, server_ip) IS DISTINCT
                   FROM '0'||nvl(client_ip, server_ip))
              AND '1'||nvl(client_ip, server_ip) > '0'||nvl(client_ip, server_ip)
              AND '1'||nvl(client_ip, server_ip) >= '0'||nvl(client_ip, server_ip)
              AND '1'||nvl(client_ip, server_ip) < 2||nvl(client_ip, server_ip)
              AND '1'||nvl(client_ip, server_ip) <= 2||nvl(client_ip, server_ip)
              AND ('1'||nvl(client_ip, server_ip) <> '0'||nvl(client_ip, server_ip)) IS TRUE
              AND ('1'||nvl(client_ip, server_ip) = '0'||nvl(client_ip, server_ip)) IS NOT TRUE
              AND ('1'||nvl(client_ip, server_ip) = '0'||nvl(client_ip, server_ip)) IS FALSE
              AND ('1'||nvl(client_ip, server_ip) <> '0'||nvl(client_ip, server_ip)) IS NOT FALSE
              AND '1'||nvl(client_ip, server_ip) BETWEEN '0'||nvl(client_ip, server_ip) AND 2||nvl(client_ip, server_ip)
              AND '1'||nvl(client_ip, server_ip) NOT BETWEEN '1'||nvl(client_ip, server_ip) AND '0'||nvl(client_ip, server_ip)
              AND '1'||nvl(client_ip, server_ip) like '%'
              AND '1'||nvl(client_ip, server_ip) not like '__DOES_NOT_EXIST__%'
              AND '1'||nvl(client_ip, server_ip) IN ('0'||nvl(client_ip, server_ip),
                                                     1||nvl(client_ip, server_ip),
                                                     2||nvl(client_ip, server_ip))
              AND '1'||nvl(client_ip, server_ip) NOT IN ('0'||nvl(client_ip, server_ip),
                                                         2||nvl(client_ip, server_ip))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A16_q_simple
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||to_json_string(nvl(event, agent)) IS NULL
       OR ('1'||to_json_string(nvl(event, agent)) = 1||to_json_string(nvl(event, agent))
           AND '1'||to_json_string(nvl(event, agent)) IS NOT DISTINCT
           FROM 1||to_json_string(nvl(event, agent))
           AND '1'||to_json_string(nvl(event, agent)) <> '0'||to_json_string(nvl(event, agent))
           AND ('1'||to_json_string(nvl(event, agent)) IS DISTINCT
                FROM '0'||to_json_string(nvl(event, agent)))
           AND '1'||to_json_string(nvl(event, agent)) > '0'||to_json_string(nvl(event, agent))
           AND '1'||to_json_string(nvl(event, agent)) >= '0'||to_json_string(nvl(event, agent))
           AND '1'||to_json_string(nvl(event, agent)) < 2||to_json_string(nvl(event, agent))
           AND '1'||to_json_string(nvl(event, agent)) <= 2||to_json_string(nvl(event, agent))
           AND ('1'||to_json_string(nvl(event, agent)) <> '0'||to_json_string(nvl(event, agent))) IS TRUE
           AND ('1'||to_json_string(nvl(event, agent)) = '0'||to_json_string(nvl(event, agent))) IS NOT TRUE
           AND ('1'||to_json_string(nvl(event, agent)) = '0'||to_json_string(nvl(event, agent))) IS FALSE
           AND ('1'||to_json_string(nvl(event, agent)) <> '0'||to_json_string(nvl(event, agent))) IS NOT FALSE
           AND '1'||to_json_string(nvl(event, agent)) BETWEEN '0'||to_json_string(nvl(event, agent)) AND 2||to_json_string(nvl(event, agent))
           AND '1'||to_json_string(nvl(event, agent)) NOT BETWEEN '1'||to_json_string(nvl(event, agent)) AND '0'||to_json_string(nvl(event, agent))
           AND '1'||to_json_string(nvl(event, agent)) like '%'
           AND '1'||to_json_string(nvl(event, agent)) not like '__DOES_NOT_EXIST__%'
           AND '1'||to_json_string(nvl(event, agent)) IN ('0'||to_json_string(nvl(event, agent)),
                                                          1||to_json_string(nvl(event, agent)),
                                                          2||to_json_string(nvl(event, agent)))
           AND '1'||to_json_string(nvl(event, agent)) NOT IN ('0'||to_json_string(nvl(event, agent)),
                                                              2||to_json_string(nvl(event, agent))))) ;
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A16_q_subq
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM test_sql
WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
  AND ('1'||to_json_string(nvl(event, agent)) IS NULL
       OR '1'||to_json_string(nvl(event, agent)) IN
         (SELECT '1'||to_json_string(nvl(event, agent))
          FROM test_sql
          WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
            AND ('1'||to_json_string(nvl(event, agent)) IS NULL
                 OR ('1'||to_json_string(nvl(event, agent)) = 1||to_json_string(nvl(event, agent))
                     AND '1'||to_json_string(nvl(event, agent)) IS NOT DISTINCT
                     FROM 1||to_json_string(nvl(event, agent))
                     AND '1'||to_json_string(nvl(event, agent)) <> '0'||to_json_string(nvl(event, agent))
                     AND ('1'||to_json_string(nvl(event, agent)) IS DISTINCT
                          FROM '0'||to_json_string(nvl(event, agent)))
                     AND '1'||to_json_string(nvl(event, agent)) > '0'||to_json_string(nvl(event, agent))
                     AND '1'||to_json_string(nvl(event, agent)) >= '0'||to_json_string(nvl(event, agent))
                     AND '1'||to_json_string(nvl(event, agent)) < 2||to_json_string(nvl(event, agent))
                     AND '1'||to_json_string(nvl(event, agent)) <= 2||to_json_string(nvl(event, agent))
                     AND ('1'||to_json_string(nvl(event, agent)) <> '0'||to_json_string(nvl(event, agent))) IS TRUE
                     AND ('1'||to_json_string(nvl(event, agent)) = '0'||to_json_string(nvl(event, agent))) IS NOT TRUE
                     AND ('1'||to_json_string(nvl(event, agent)) = '0'||to_json_string(nvl(event, agent))) IS FALSE
                     AND ('1'||to_json_string(nvl(event, agent)) <> '0'||to_json_string(nvl(event, agent))) IS NOT FALSE
                     AND '1'||to_json_string(nvl(event, agent)) BETWEEN '0'||to_json_string(nvl(event, agent)) AND 2||to_json_string(nvl(event, agent))
                     AND '1'||to_json_string(nvl(event, agent)) NOT BETWEEN '1'||to_json_string(nvl(event, agent)) AND '0'||to_json_string(nvl(event, agent))
                     AND '1'||to_json_string(nvl(event, agent)) like '%'
                     AND '1'||to_json_string(nvl(event, agent)) not like '__DOES_NOT_EXIST__%'
                     AND '1'||to_json_string(nvl(event, agent)) IN ('0'||to_json_string(nvl(event, agent)),
                                                                    1||to_json_string(nvl(event, agent)),
                                                                    2||to_json_string(nvl(event, agent)))
                     AND '1'||to_json_string(nvl(event, agent)) NOT IN ('0'||to_json_string(nvl(event, agent)),
                                                                        2||to_json_string(nvl(event, agent)))))));
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

#-------------------------------------------------------------------------
# TESTCASE: scalar_other TEST_ID: A16_q_grpby
#-------------------------------------------------------------------------
SELECT count(*) cnt
FROM
  (SELECT __time, number, client_ip,
                          '1'||to_json_string(nvl(event, agent)),
                          count(*)
   FROM test_sql
   WHERE time_floor(__time, 'PT1H') BETWEEN timestamp '2019-08-25 00:00:00' AND timestamp '2019-08-25 06:00:00'
     AND ('1'||to_json_string(nvl(event, agent)) IS NULL
          OR ('1'||to_json_string(nvl(event, agent)) = 1||to_json_string(nvl(event, agent))
              AND '1'||to_json_string(nvl(event, agent)) IS NOT DISTINCT
              FROM 1||to_json_string(nvl(event, agent))
              AND '1'||to_json_string(nvl(event, agent)) <> '0'||to_json_string(nvl(event, agent))
              AND ('1'||to_json_string(nvl(event, agent)) IS DISTINCT
                   FROM '0'||to_json_string(nvl(event, agent)))
              AND '1'||to_json_string(nvl(event, agent)) > '0'||to_json_string(nvl(event, agent))
              AND '1'||to_json_string(nvl(event, agent)) >= '0'||to_json_string(nvl(event, agent))
              AND '1'||to_json_string(nvl(event, agent)) < 2||to_json_string(nvl(event, agent))
              AND '1'||to_json_string(nvl(event, agent)) <= 2||to_json_string(nvl(event, agent))
              AND ('1'||to_json_string(nvl(event, agent)) <> '0'||to_json_string(nvl(event, agent))) IS TRUE
              AND ('1'||to_json_string(nvl(event, agent)) = '0'||to_json_string(nvl(event, agent))) IS NOT TRUE
              AND ('1'||to_json_string(nvl(event, agent)) = '0'||to_json_string(nvl(event, agent))) IS FALSE
              AND ('1'||to_json_string(nvl(event, agent)) <> '0'||to_json_string(nvl(event, agent))) IS NOT FALSE
              AND '1'||to_json_string(nvl(event, agent)) BETWEEN '0'||to_json_string(nvl(event, agent)) AND 2||to_json_string(nvl(event, agent))
              AND '1'||to_json_string(nvl(event, agent)) NOT BETWEEN '1'||to_json_string(nvl(event, agent)) AND '0'||to_json_string(nvl(event, agent))
              AND '1'||to_json_string(nvl(event, agent)) like '%'
              AND '1'||to_json_string(nvl(event, agent)) not like '__DOES_NOT_EXIST__%'
              AND '1'||to_json_string(nvl(event, agent)) IN ('0'||to_json_string(nvl(event, agent)),
                                                             1||to_json_string(nvl(event, agent)),
                                                             2||to_json_string(nvl(event, agent)))
              AND '1'||to_json_string(nvl(event, agent)) NOT IN ('0'||to_json_string(nvl(event, agent)),
                                                                 2||to_json_string(nvl(event, agent)))))
   GROUP BY 1,
            2,
            3,
            4);
+-------+
| cnt   |
+-------+
| 78197 |
+-------+
(1 row)

!ok

