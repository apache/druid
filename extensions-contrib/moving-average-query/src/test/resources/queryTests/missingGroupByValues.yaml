query:
  queryType: movingAverage
  dataSource:
    type: table
    name: slice_pf_us_pl_dt_os
  context: {
  }
  granularity:
    type: period
    period: P1D
  intervals:
  - 2017-01-02T00:00Z/2017-01-03T00:00Z
  dimensions:
  - gender
  averagers:
  - buckets: 2
    name: trailing7DayAvgTimeSpent
    fieldName: timeSpent
    type: doubleMean
  aggregations:
  - name: timespent_secs
    fieldName: timespent
    type: longSum
  - name: regBcookies
    fieldName: bcookies_with_yuid_sketch
    size: 16384
    type: thetaSketch
  postAggregations:
  - type: arithmetic
    name: timeSpent
    fn: /
    fields:
    - type: fieldAccess
      fieldName: timespent_secs
    - type: constant
      name: seconds_per_minute
      value: 60.0
  postAveragers: [
  ]
expectedOutput:
- version: v1
  timestamp: 2017-01-02T00:00Z
  event:
    gender: m
    timespent_secs: 240
    timeSpent: 4.0
    trailing7DayAvgTimeSpent: 3.0
    regBcookies: 0.0
- version: v1
  timestamp: 2017-01-02T00:00Z
  event:
    gender: f
    timespent_secs: 0
    timeSpent: 0.0
    trailing7DayAvgTimeSpent: 1.0
    regBcookies: 0.0
intermediateResults:
  groupBy:
  - version: v1
    timestamp: 2017-01-01T00:00Z
    event:
      gender: m
      timespent_secs: 120
      timeSpent: 2.0
      regBcookies: AwEDAAAAAgAAAAAAAAAAAP////////9/
  - version: v1
    timestamp: 2017-01-01T00:00Z
    event:
      gender: f
      timespent_secs: 120
      timeSpent: 2.0
      regBcookies: AwEDAAAAAgAAAAAAAAAAAP////////9/
  - version: v1
    timestamp: 2017-01-02T00:00Z
    event:
      gender: m
      timespent_secs: 240
      timeSpent: 4.0
      regBcookies: AwEDAAAAAgAAAAAAAAAAAP////////9/
