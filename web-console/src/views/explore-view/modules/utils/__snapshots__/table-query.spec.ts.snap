// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`table-query uber test all queries match snapshot 1`] = `
"
===========================================
no group by, no show, no metrics, no compare, no order by
-----
SELECT COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, no compare, no order by
-----
SELECT COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, no compare, order by Count
-----
SELECT COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, no compare, no order by
-----
SELECT
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, no compare, order by Count
-----
SELECT
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, no compare, order by Unique sessions
-----
SELECT
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
SELECT
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, no compare, no order by
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, no compare, order by Browser
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
SELECT CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, no compare, no order by
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, no compare, order by Browser
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, no compare, order by Count
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, no compare, no order by
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, no compare, order by Browser
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, no compare, order by Count
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, no compare, order by Unique sessions
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Browser" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
no group by, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
SELECT
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, no compare, no order by
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, no compare, order by BrowserVersion
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT "t"."browser_version" AS "BrowserVersion"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, no compare, no order by
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, no compare, order by BrowserVersion
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, no compare, order by Count
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, no compare, no order by
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, no compare, order by BrowserVersion
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, no compare, order by Count
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, no compare, order by Unique sessions
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, no compare, no order by
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, no compare, order by BrowserVersion
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, no compare, order by Browser
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, no compare, no order by
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, no compare, order by BrowserVersion
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, no compare, order by Browser
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, no compare, order by Count
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, no compare, no order by
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, no compare, order by BrowserVersion
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, no compare, order by Browser
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, no compare, order by Count
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, no compare, order by Unique sessions
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by browser_version, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
SELECT
  "t"."browser_version" AS "BrowserVersion",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, no compare, no order by
-----
SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, no compare, order by Time
-----
SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, no metrics, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, one metric, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, one metric, no compare, order by Count
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, no compare, order by Count
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, no compare, order by Unique sessions
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, no compare, order by Browser
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, no compare, order by Browser
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, no compare, order by Count
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, no compare, order by Browser
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, no compare, order by Count
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, no compare, order by Unique sessions
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT TIME_FLOOR("t"."__time", 'PT1H') AS "Time"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time"
GROUP BY 1
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, no compare, no order by
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, no compare, order by BrowserVersion
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, no compare, order by country
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, value+delta, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, value+delta, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, delta+percent, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, delta+percent, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, all compare types, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, no metrics, compare PT1H, all compare types, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, no compare, no order by
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, no compare, order by BrowserVersion
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, no compare, order by country
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, no compare, order by Count
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, no compare, no order by
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, no compare, order by BrowserVersion
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, no compare, order by country
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, no compare, order by Count
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, no compare, order by Unique sessions
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, no compare, no order by
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, no compare, order by BrowserVersion
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, no compare, order by country
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, no compare, order by Browser
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, value+delta, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, value+delta, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, delta+percent, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, delta+percent, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, all compare types, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, all compare types, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, no compare, no order by
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, no compare, order by BrowserVersion
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, no compare, order by country
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, no compare, order by Browser
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, no compare, order by Count
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, no compare, no order by
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, no compare, order by BrowserVersion
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, no compare, order by country
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, no compare, order by Browser
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, no compare, order by Count
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, no compare, order by Unique sessions
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by country, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by country, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things without time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
SELECT
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Count",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) AS "Unique sessions",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:value",
  COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(*) FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00'), 0) - COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0) AS DOUBLE), COALESCE(COUNT(DISTINCT "session") FILTER (WHERE TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "kttm" AS "t"
WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
GROUP BY 1, 2
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, no compare, order by BrowserVersion
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, no compare, order by country
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, value+delta, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, value+delta, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, delta+percent, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, delta+percent, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, all compare types, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, no metrics, compare PT1H, all compare types, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, no compare, order by BrowserVersion
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, no compare, order by country
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, no compare, order by Count
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, no show, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, no compare, order by BrowserVersion
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, no compare, order by country
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, no compare, order by Count
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, no compare, order by Unique sessions
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, no show, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, no compare, order by BrowserVersion
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, no compare, order by country
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, no compare, order by Browser
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, no metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, no compare, order by BrowserVersion
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, no compare, order by country
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, no compare, order by Browser
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, no compare, order by Count
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, one metric, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, no compare, no order by
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, no compare, order by Time
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, no compare, order by BrowserVersion
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, no compare, order by country
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, no compare, order by Browser
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, no compare, order by Count
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, no compare, order by Unique sessions
-----
SELECT
  TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
  LOWER("t".browser_version) AS "BrowserVersion",
  "t"."country" AS "country",
  CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
  COUNT(*) AS "Count",
  COUNT(DISTINCT "session") AS "Unique sessions"
FROM "kttm" AS "t"
WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, value+delta, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, delta+percent, Unique sessions/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, no order by, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, no order by, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by Time, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Time" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by Time, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY TIME_FLOOR("t"."__time", 'PT1H') DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Time" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "BrowserVersion" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by BrowserVersion, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY LOWER("t".browser_version) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "BrowserVersion" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by country, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "country" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by country, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "t"."country" DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "country" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Browser" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by Browser, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Browser" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by Count, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, order by Unique sessions, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Count" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Count/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(*) DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Count:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/value, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 200
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:value" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/delta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:delta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absDelta, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:absDelta" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/percent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:percent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict never
-----
WITH
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 50000
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY "Unique sessions" DESC
  LIMIT 50000
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200

===========================================
group by several things and time, show browser, two metrics, compare PT1H, all compare types, Unique sessions/PT1H/absPercent, restrict always
-----
WITH
"top_values" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country"
  FROM "kttm" AS "t"
  WHERE ((TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') OR (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1))) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
  ORDER BY COUNT(DISTINCT "session") DESC
  LIMIT 5000
),
"main" AS (
  SELECT
    TIME_FLOOR("t"."__time", 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR("t"."__time", 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIMESTAMP '2019-08-26 00:00:00') AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
),
"compare_PT1H" AS (
  SELECT
    TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') AS "Time",
    LOWER("t".browser_version) AS "BrowserVersion",
    "t"."country" AS "country",
    CASE WHEN COUNT(DISTINCT "browser") = 1 THEN LATEST("browser") ELSE NULL END AS "Browser",
    COUNT(*) AS "Count",
    COUNT(DISTINCT "session") AS "Unique sessions"
  FROM "kttm" AS "t"
  INNER JOIN "top_values" ON TIME_FLOOR(TIME_SHIFT("t"."__time", 'PT1H', 1), 'PT1H') IS NOT DISTINCT FROM "top_values"."Time" AND LOWER("t".browser_version) IS NOT DISTINCT FROM "top_values"."BrowserVersion" AND "t"."country" IS NOT DISTINCT FROM "top_values"."country"
  WHERE (TIME_SHIFT(TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1), 'PT1H', -1) <= "t"."__time" AND "t"."__time" < TIME_SHIFT(TIMESTAMP '2019-08-26 00:00:00', 'PT1H', -1)) AND "t"."country" = 'United States'
  GROUP BY 1, 2, 3
)
SELECT
  COALESCE("main"."Time", "compare_PT1H"."Time") AS "Time",
  COALESCE("main"."BrowserVersion", "compare_PT1H"."BrowserVersion") AS "BrowserVersion",
  COALESCE("main"."country", "compare_PT1H"."country") AS "country",
  COALESCE(ANY_VALUE("main"."Browser"), ANY_VALUE("compare_PT1H"."Browser")) AS "Browser",
  COALESCE(ANY_VALUE("main"."Count"), 0) AS "Count",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) AS "Unique sessions",
  COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS "Count:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)) AS "Count:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0) AS "Count:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Count"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Count"), 0)), 0)) AS "Count:compare:PT1H:absPercent",
  COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:value",
  COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS "Unique sessions:compare:PT1H:delta",
  ABS(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)) AS "Unique sessions:compare:PT1H:absDelta",
  COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0) AS "Unique sessions:compare:PT1H:percent",
  ABS(COALESCE(SAFE_DIVIDE(CAST(COALESCE(ANY_VALUE("main"."Unique sessions"), 0) - COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0) AS DOUBLE), COALESCE(ANY_VALUE("compare_PT1H"."Unique sessions"), 0)), 0)) AS "Unique sessions:compare:PT1H:absPercent"
FROM "main"
FULL JOIN "compare_PT1H" ON "main"."Time" IS NOT DISTINCT FROM "compare_PT1H"."Time" AND "main"."BrowserVersion" IS NOT DISTINCT FROM "compare_PT1H"."BrowserVersion" AND "main"."country" IS NOT DISTINCT FROM "compare_PT1H"."country"
GROUP BY 1, 2, 3
ORDER BY "Unique sessions:compare:PT1H:absPercent" DESC
LIMIT 200"
`;
